<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Cuaderno de Apuntes - Macroeconom铆a I | Edaly Yamileth Paredes Condori - UNA v3.0</title>
    <link rel="icon" href="/assets/fie.png">
    <link
        href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Caveat:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400;1,700&family=UnifrakturMaguntia&family=Grenze+Gotisch:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">

    <!-- MathJax global para renderizar f贸rmulas en todo el sitio -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)'], ['$', '$']],
                displayMath: [['\\[', '\\]'], ['$$', '$$']],
                macros: {
                    Pr: "\\operatorname{Pr}",
                    Var: "\\operatorname{Var}",
                    SE: "\\operatorname{SE}",
                    MSE: "\\operatorname{MSE}",
                    E: "\\mathbb{E}",
                    Normal: ["\\mathcal{N}\\left(#1,#2\\right)", 2],
                    tStudent: ["\\mathrm{t}_{#1}", 1],
                    ChiSq: ["\\chi^2_{#1}", 1],
                    FDist: ["\\mathrm{F}_{#1,#2}", 2]
                }
            }
        };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        body {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);
            font-family: 'Kalam', cursive;
            height: 100vh;
            padding: 0;
            overflow: hidden;
            position: relative;
            margin: 0;
        }

        /* Efectos de fondo */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        /* Barra lateral de navegaci贸n */
        .sidebar {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 30;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 15px;
            border-radius: 20px;
            border: 2px solid rgba(139, 69, 19, 0.2);
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .nav-btn {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 15px;
            font-family: 'Kalam', cursive;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            box-shadow:
                0 4px 12px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: rotate(-1deg);
            min-width: 120px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            transform: rotate(0deg) translateY(-3px);
            box-shadow:
                0 8px 20px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .nav-btn:active {
            transform: rotate(0deg) translateY(-1px);
            box-shadow:
                0 4px 10px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: rotate(-1deg);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        /* Men煤 desplegable de navegaci贸n */
        .nav-menu {
            position: relative;
            margin-bottom: 10px;
        }

        .nav-menu-btn {
            background: linear-gradient(145deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            font-family: 'Kalam', cursive;
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            transform: rotate(-1deg);
            min-width: 140px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-menu-btn:hover {
            transform: rotate(0deg) translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .nav-menu-btn .arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .nav-menu-btn.active .arrow {
            transform: rotate(180deg);
        }

        .nav-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            border: 2px solid rgba(16, 185, 129, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .nav-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-unit {
            border-bottom: 1px solid rgba(16, 185, 129, 0.1);
        }

        .nav-unit:last-child {
            border-bottom: none;
        }

        .nav-unit-title {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 8px 12px;
            font-family: 'Caveat', cursive;
            font-size: 14px;
            font-weight: 600;
            color: #0c4a6e;
            border-bottom: 1px solid rgba(16, 185, 129, 0.1);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .nav-unit-title:hover {
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
        }

        .nav-pages {
            padding: 5px 0;
        }

        .nav-page-item {
            padding: 6px 15px;
            font-family: 'Kalam', cursive;
            font-size: 11px;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-page-item:hover {
            background: rgba(16, 185, 129, 0.1);
            border-left-color: #10b981;
            color: #065f46;
        }

        .nav-page-item.current {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
        }

        /* Grupos de semanas en navegaci贸n */
        .nav-week-group {
            margin-bottom: 15px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
            padding-left: 10px;
        }

        .nav-week-title {
            font-family: 'Caveat', cursive;
            font-size: 16px;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-week-group .nav-page-item {
            margin-left: 10px;
            font-size: 13px;
            padding: 6px 10px;
        }

        /* Scrollbar personalizado para el dropdown */
        .nav-dropdown::-webkit-scrollbar {
            width: 6px;
        }

        .nav-dropdown::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .nav-dropdown::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.5);
            border-radius: 3px;
        }

        .nav-dropdown::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 185, 129, 0.7);
        }

        /* Cuaderno */
        .notebook-container {
            max-width: calc(100vw - 160px);
            width: calc(100vw - 160px);
            height: calc(100vh - 20px);
            margin: 10px auto 10px 150px;
            position: relative;
            transform: translateY(0);
            animation: float 8s ease-in-out infinite;
            z-index: 10;
            overflow: hidden;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        .notebook {
            background: linear-gradient(145deg, #2C1810, #1a0f08);
            border-radius: 15px;
            padding: 20px;
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            width: 100%;
            height: 100%;
            border: 3px solid #3d2817;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* Espiral mejorada */
        .spiral-binding {
            position: absolute;
            left: 40px;
            top: 25px;
            bottom: 25px;
            width: 30px;
            background:
                repeating-linear-gradient(to bottom,
                    #666 0px,
                    #666 8px,
                    #888 8px,
                    #888 12px,
                    transparent 12px,
                    transparent 25px);
            border-radius: 12px;
            z-index: 10;
            box-shadow:
                inset 0 0 10px rgba(0, 0, 0, 0.5),
                0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* P谩gina con efecto flipbook mejorado */
        .notebook-page {
            width: calc(100% - 30px);
            height: calc(100% - 30px);
            background:
                linear-gradient(90deg,
                    transparent 0px,
                    transparent 119px,
                    #ff6b6b 119px,
                    #ff6b6b 121px,
                    transparent 121px),
                repeating-linear-gradient(transparent,
                    transparent 29px,
                    #e3f2fd 29px,
                    #e3f2fd 31px);
            background-color: #fefefe;
            margin-left: 30px;
            border-radius: 8px;
            position: relative;
            box-shadow:
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            overflow: visible;
            transform-origin: left center;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-style: preserve-3d;
        }

        /* P谩ginas adicionales para efecto flipbook */
        .notebook-page::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: -5px;
            bottom: -5px;
            background:
                linear-gradient(90deg,
                    transparent 0px,
                    transparent 119px,
                    #ff6b6b 119px,
                    #ff6b6b 121px,
                    transparent 121px),
                repeating-linear-gradient(transparent,
                    transparent 29px,
                    #e3f2fd 29px,
                    #e3f2fd 31px);
            background-color: #f8f8f8;
            border-radius: 8px;
            z-index: -1;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }

        .notebook-page::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: -10px;
            bottom: -10px;
            background:
                linear-gradient(90deg,
                    transparent 0px,
                    transparent 119px,
                    #ff6b6b 119px,
                    #ff6b6b 121px,
                    transparent 121px),
                repeating-linear-gradient(transparent,
                    transparent 29px,
                    #e3f2fd 29px,
                    #e3f2fd 31px);
            background-color: #f0f0f0;
            border-radius: 8px;
            z-index: -2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* ====== ANIMACIONES DE PASO DE PGINA ESTILO CUADERNO ====== */

        /* Animaci贸n para AVANZAR - p谩gina desliza hacia la izquierda */
        .page-flipping-next {
            animation: slidePageNext 0.6s ease-in-out forwards;
        }

        @keyframes slidePageNext {
            0% {
                transform: translateX(0) rotateY(0deg);
                opacity: 1;
            }

            40% {
                transform: translateX(-30px) rotateY(-15deg);
                opacity: 0.9;
            }

            60% {
                transform: translateX(-50px) rotateY(-25deg);
                opacity: 0.5;
            }

            100% {
                transform: translateX(-100px) rotateY(-45deg);
                opacity: 0;
            }
        }

        /* Animaci贸n para RETROCEDER - p谩gina desliza desde la izquierda */
        .page-flipping-prev {
            animation: slidePagePrev 0.6s ease-in-out forwards;
        }

        @keyframes slidePagePrev {
            0% {
                transform: translateX(0) rotateY(0deg);
                opacity: 1;
            }

            40% {
                transform: translateX(30px) rotateY(15deg);
                opacity: 0.9;
            }

            60% {
                transform: translateX(50px) rotateY(25deg);
                opacity: 0.5;
            }

            100% {
                transform: translateX(100px) rotateY(45deg);
                opacity: 0;
            }
        }

        /* Animaci贸n gen茅rica (compatibilidad) */
        .page-flipping {
            animation: slidePageNext 0.6s ease-in-out forwards;
        }

        /* Efecto de curvatura del papel */
        .page-flipping-next .page-content,
        .page-flipping-prev .page-content {
            filter: drop-shadow(2px 0 5px rgba(0, 0, 0, 0.1));
        }

        .page-content {
            padding: 25px 30px 30px 110px;
            height: calc(100% - 10px);
            position: relative;
            z-index: 5;
            line-height: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            box-sizing: border-box;
        }

        /* Logo de la FIE en la esquina superior derecha */
        .fie-logo {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 60px;
            height: auto;
            z-index: 10;
            opacity: 0.8;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .fie-logo:hover {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Ocultar logo FIE cuando se muestra la portada */
        .notebook-page[data-unit="0"] .fie-logo {
            display: none !important;
        }

        /* Estilos de escritura mejorados */
        .handwritten-title {
            font-family: 'Caveat', cursive;
            font-size: 26px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 8px;
            transform: rotate(-0.5deg);
            text-shadow:
                1px 1px 2px rgba(0, 0, 0, 0.1),
                0 0 10px rgba(30, 64, 175, 0.2);
            position: relative;
        }

        .handwritten-text {
            font-family: 'Kalam', cursive;
            font-size: 13px;
            color: #2d3748;
            margin-bottom: 6px;
            transform: rotate(0.1deg);
            line-height: 22px;
            position: relative;
        }

        .handwritten-formula {
            background:
                linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.2));
            border: 3px dashed #3b82f6;
            border-radius: 12px;
            padding: 8px;
            margin: 10px 0;
            font-family: 'Caveat', cursive;
            font-size: 16px;
            font-weight: 600;
            color: #1e40af;
            text-align: center;
            transform: rotate(-0.3deg);
            position: relative;
            box-shadow:
                0 2px 8px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .highlighted-note {
            background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
            border-left: 5px solid #f59e0b;
            padding: 8px;
            margin: 8px 0;
            font-family: 'Kalam', cursive;
            font-size: 12px;
            color: #92400e;
            font-style: italic;
            transform: rotate(-0.2deg);
            border-radius: 0 8px 8px 0;
            position: relative;
            box-shadow:
                0 2px 8px rgba(245, 158, 11, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        /* Tablas estilo cuaderno */
        .handwritten-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-family: 'Kalam', cursive;
            font-size: 11px;
            transform: rotate(-0.1deg);
        }

        .handwritten-table th {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 6px;
            text-align: left;
            font-weight: bold;
            border: 2px solid #1e40af;
        }

        .handwritten-table td {
            padding: 4px 6px;
            border: 1px solid #94a3b8;
            background: rgba(255, 255, 255, 0.7);
        }

        .handwritten-table tr:nth-child(even) td {
            background: rgba(241, 245, 249, 0.8);
        }

        /* Cajas de informaci贸n */
        .info-box {
            background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
            border: 2px solid #0288d1;
            border-radius: 10px;
            padding: 8px;
            margin: 10px 0;
            transform: rotate(0.2deg);
            box-shadow: 0 4px 12px rgba(2, 136, 209, 0.2);
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 2px solid #f57c00;
            border-radius: 10px;
            padding: 8px;
            margin: 10px 0;
            transform: rotate(-0.3deg);
            box-shadow: 0 4px 12px rgba(245, 124, 0, 0.2);
        }

        .success-box {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border: 2px solid #388e3c;
            border-radius: 10px;
            padding: 8px;
            margin: 10px 0;
            transform: rotate(0.1deg);
            box-shadow: 0 4px 12px rgba(56, 142, 60, 0.2);
        }

        /* F贸rmulas destacadas */
        .formula-box {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            border: 3px dashed #8e24aa;
            border-radius: 12px;
            padding: 10px;
            margin: 12px 0;
            font-family: 'Caveat', cursive;
            font-size: 18px;
            font-weight: 600;
            color: #4a148c;
            text-align: center;
            transform: rotate(-0.2deg);
            box-shadow: 0 4px 12px rgba(142, 36, 170, 0.2);
        }

        /* Definiciones */
        .definition-box {
            background: linear-gradient(135deg, #fce4ec, #f8bbd9);
            border-left: 6px solid #e91e63;
            padding: 8px;
            margin: 10px 0;
            font-style: italic;
            border-radius: 0 10px 10px 0;
            transform: rotate(0.1deg);
        }

        /* Ejemplos pr谩cticos */
        .example-box {
            background: linear-gradient(135deg, #f1f8e9, #dcedc8);
            border: 2px dotted #689f38;
            border-radius: 8px;
            padding: 8px;
            margin: 10px 0;
            transform: rotate(-0.1deg);
        }

        /* Ejemplos en espa帽ol */
        .ejemplo-box {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Kalam', cursive;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.2);
        }

        .ejemplo-box strong {
            color: #2e7d32;
        }

        /* Caja de resumen */
        .resumen-box {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Kalam', cursive;
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        }

        .resumen-box ul {
            list-style-type: none;
            padding-left: 0;
        }

        .resumen-box li {
            padding: 4px 0;
            border-bottom: 1px dashed rgba(33, 150, 243, 0.3);
        }

        .resumen-box li:last-child {
            border-bottom: none;
        }

        /* Caja de ejercicios */
        .ejercicio-box {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Kalam', cursive;
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.2);
        }

        .ejercicio-box strong {
            color: #e65100;
        }

        .ejercicio-box p {
            margin: 6px 0;
        }

        /* Tabla de datos */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-family: 'Kalam', cursive;
            font-size: 12px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: bold;
            border: 1px solid #1e40af;
        }

        .data-table td {
            padding: 8px 12px;
            border: 1px solid #e2e8f0;
            background: rgba(255, 255, 255, 0.9);
        }

        .data-table tr:nth-child(even) td {
            background: rgba(241, 245, 249, 0.9);
        }

        .data-table tr:hover td {
            background: rgba(59, 130, 246, 0.1);
        }


        /* Sticky Note para informaci贸n clave */
        .sticky-note {
            position: absolute;
            top: 80px;
            right: 20px;
            width: 220px;
            background: linear-gradient(135deg, #fff9c4, #fff59d);
            border: 1px solid #f57f17;
            border-radius: 8px;
            padding: 15px;
            box-shadow:
                0 4px 8px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(245, 127, 23, 0.2);
            transform: rotate(2deg);
            z-index: 5;
            font-family: 'Caveat', cursive;
            font-size: 14px;
        }

        .sticky-note::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 15px;
            background: rgba(255, 193, 7, 0.6);
            border-radius: 0 0 8px 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sticky-note-title {
            font-weight: bold;
            color: #e65100;
            margin-bottom: 8px;
            text-align: center;
            font-size: 16px;
        }

        .sticky-note-content {
            color: #5d4037;
            line-height: 1.4;
            text-align: center;
        }



        /* Gr谩ficos placeholder mejorados */
        .graph-placeholder {
            border: 3px dashed #666;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            background: linear-gradient(135deg, #f9f9f9, #f0f0f0);
            border-radius: 12px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transform: rotate(0.1deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .graph-title {
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .graph-description {
            font-size: 12px;
            color: #718096;
            font-style: italic;
        }

        /* Contenedor para im谩genes reales */
        .graph-container {
            margin: 20px 0;
            text-align: center;
            background: linear-gradient(135deg, #f9f9f9, #f0f0f0);
            border-radius: 12px;
            padding: 15px;
            transform: rotate(0.1deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .graph-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin: 10px 0;
            border: 2px solid #e2e8f0;
            background: white;
            padding: 5px;
        }

        .graph-container .graph-title {
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 10px;
            font-family: 'Caveat', cursive;
        }

        .graph-container .graph-description {
            font-size: 12px;
            color: #718096;
            font-style: italic;
            margin-top: 8px;
            font-family: 'Kalam', cursive;
        }

        /* Layout de dos columnas para contenido con im谩genes */
        .two-column-layout {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            align-items: flex-start;
        }

        .column-left {
            flex: 1;
            min-width: 0;
        }

        .column-right {
            flex: 1;
            min-width: 0;
        }

        .column-image {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid #e2e8f0;
            background: white;
            padding: 5px;
        }

        .image-caption {
            font-size: 11px;
            color: #718096;
            font-style: italic;
            text-align: center;
            margin-top: 5px;
            font-family: 'Kalam', cursive;
        }

        /* Fallback visual cuando <img> no renderiza: usa background-image */
        .image-fallback {
            width: 100%;
            max-width: 100%;
            min-height: 220px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid #e2e8f0;
            background-color: #fff;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }

        /* Responsive: en pantallas peque帽as, volver a columna 煤nica */
        @media (max-width: 768px) {
            .two-column-layout {
                flex-direction: column;
            }
        }

        .page-number {
            position: absolute;
            bottom: 20px;
            right: 30px;
            font-family: 'Caveat', cursive;
            font-size: 18px;
            color: #6b7280;
            transform: rotate(-2deg);
            border: 2px solid #6b7280;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        /* ========== PORTADA MEJORADA - PROFESSIONAL LUXURY ========== */
        .cover-page {
            position: absolute;
            top: -40px;
            left: -130px;
            right: -20px;
            bottom: -40px;
            padding: 20px;
            background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 8px solid #1e293b;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.9);
            z-index: 100;
            border-radius: 0 12px 12px 0;
        }

        /* Trama de fondo tecnol贸gica/econ贸mica */
        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            background-position: center;
            opacity: 0.4;
            z-index: 1;
            pointer-events: none;
        }

        /* Marco Dorado con esquinas */
        .cover-frame {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border: 2px solid rgba(217, 119, 6, 0.3);
            border-radius: 15px;
            z-index: 2;
            pointer-events: none;
            box-shadow: inset 0 0 40px rgba(217, 119, 6, 0.05);
        }

        .cover-frame::before,
        .cover-frame::after {
            content: '';
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px solid #d97706;
            transition: all 0.5s ease;
        }

        .cover-frame::before {
            top: -2px;
            left: -2px;
            border-right: none;
            border-bottom: none;
            border-radius: 15px 0 0 0;
        }

        .cover-frame::after {
            bottom: -2px;
            right: -2px;
            border-left: none;
            border-top: none;
            border-radius: 0 0 15px 0;
        }

        /* Contenedor principal centrado */
        .cover-content {
            position: relative;
            z-index: 10;
            width: 90%;
            max-width: 900px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            padding: 40px;
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow:
                0 25px 50px -12px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transform: translateZ(0);
        }

        /* Encabezado Institucional */
        .cover-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            gap: 20px;
            border-bottom: 1px solid rgba(251, 191, 36, 0.2);
            padding-bottom: 20px;
            margin-bottom: 10px;
        }

        .uni-logo {
            width: 85px;
            height: 85px;
            object-fit: contain;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.15));
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: rgba(255, 255, 255, 0.05);
            padding: 8px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .uni-logo:hover {
            transform: scale(1.15) rotate(3deg);
            background: rgba(255, 255, 255, 0.1);
        }

        .uni-text {
            flex: 1;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .uni-title {
            font-family: 'Grenze Gotisch', Georgia, serif;
            font-size: clamp(24px, 2.5vw, 34px);
            color: #fbbf24;
            text-shadow: 0 4px 10px rgba(0, 0, 0, 0.8);
            margin: 0;
            line-height: 1.1;
            letter-spacing: 0.5px;
        }

        .uni-subtitle {
            font-family: 'Cinzel', 'Playfair Display', serif;
            font-size: clamp(12px, 1.5vw, 16px);
            color: #cbd5e1;
            margin-top: 8px;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: 600;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            padding: 4px 20px;
            border-radius: 20px;
        }

        /* T铆tulo Principal */
        .main-title-container {
            text-align: center;
            margin: 15px 0;
            position: relative;
            padding: 0 20px;
        }

        .main-title {
            font-family: 'UnifrakturMaguntia', cursive;
            font-size: clamp(50px, 7vw, 90px);
            color: transparent;
            background: linear-gradient(180deg, #fcd34d 0%, #f59e0b 50%, #b45309 100%);
            -webkit-background-clip: text;
            background-clip: text;
            filter: drop-shadow(0 5px 0px rgba(0, 0, 0, 0.5));
            line-height: 1.1;
            margin: 0;
            animation: titleFloat 6s ease-in-out infinite;
            letter-spacing: 2px;
        }

        @keyframes titleFloat {

            0%,
            100% {
                transform: translateY(0);
                filter: drop-shadow(0 5px 0px rgba(0, 0, 0, 0.5));
            }

            50% {
                transform: translateY(-8px);
                filter: drop-shadow(0 15px 5px rgba(0, 0, 0, 0.3));
            }
        }

        .semester-badge {
            background: linear-gradient(90deg, #991b1b, #ef4444);
            color: white;
            padding: 6px 24px;
            border-radius: 50px;
            font-family: 'Playfair Display', serif;
            font-weight: bold;
            font-size: clamp(14px, 1.5vw, 18px);
            display: inline-block;
            margin-top: -10px;
            position: relative;
            z-index: 2;
            box-shadow:
                0 4px 15px rgba(220, 38, 38, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid #fecaca;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Secci贸n de Docente */
        .teacher-info {
            text-align: center;
            font-family: 'Playfair Display', serif;
            color: #94a3b8;
            font-size: clamp(16px, 1.8vw, 20px);
            margin-bottom: 5px;
            background: rgba(0, 0, 0, 0.2);
            padding: 10px 30px;
            border-radius: 50px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .teacher-name {
            color: #fbbf24;
            font-style: italic;
            font-weight: 600;
            margin-left: 8px;
        }

        /* Tarjetas de Estudiantes */
        .students-box {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            width: 100%;
        }

        .student-badge {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(251, 191, 36, 0.2);
            padding: 15px 25px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            flex: 1;
            min-width: 250px;
            max-width: 350px;
            position: relative;
            overflow: hidden;
        }

        .student-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #d97706;
            opacity: 0.7;
        }

        .student-badge:hover {
            background: rgba(30, 41, 59, 1);
            transform: translateY(-5px);
            border-color: rgba(251, 191, 36, 0.6);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .student-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 3px;
            display: block;
            margin-bottom: 6px;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }

        .student-val {
            font-family: 'Playfair Display', serif;
            font-size: clamp(16px, 1.8vw, 20px);
            color: #f1f5f9;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
        }

        /* Botones de Acci贸n */
        .cover-buttons {
            display: flex;
            gap: 25px;
            margin-top: 15px;
            justify-content: center;
        }

        .glow-btn {
            position: relative;
            padding: 14px 40px;
            background: linear-gradient(180deg, rgba(15, 23, 42, 0.8) 0%, rgba(15, 23, 42, 1) 100%);
            border: 1px solid #fbbf24;
            color: #fbbf24;
            font-family: 'Grenze Gotisch', serif;
            font-size: 22px;
            border-radius: 12px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .glow-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .glow-btn:hover {
            background: #fbbf24;
            color: #0f172a;
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.4);
            transform: translateY(-3px) scale(1.02);
            border-color: #fbbf24;
        }

        .glow-btn:hover::before {
            left: 100%;
        }

        .glow-btn:active {
            transform: translateY(0);
        }

        /* Elementos decorativos */
        .decoration-icon {
            position: absolute;
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
            animation: spinSlow 60s linear infinite;
        }

        .deco-top-right {
            top: -50px;
            right: -50px;
            width: 300px;
            height: 300px;
        }

        .deco-bottom-left {
            bottom: -50px;
            left: -50px;
            width: 250px;
            height: 250px;
        }

        @keyframes spinSlow {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Ocultar elementos antiguos para compatibilidad */
        .notebook-subtitle-label,
        .logo-spaces,
        .logo-space,
        .corner-decoration,
        .notebook-decoration,
        .students-title,
        .student-icon,
        .student-name::before,
        .course-title::before,
        .start-buttons,
        .start-buttons-inner {
            display: none !important;
        }

        .cover-page {
            position: absolute;
            top: -40px;
            left: -130px;
            right: -20px;
            bottom: -40px;
            padding: 35px 40px 35px 150px;
            background: linear-gradient(180deg, #0d1b2a 0%, #1b2838 30%, #1b2838 70%, #0d1b2a 100%);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 18px;
            border: 6px solid #2c3e50;
            box-shadow:
                inset 0 0 60px rgba(0, 0, 0, 0.5),
                inset 0 0 100px rgba(0, 0, 0, 0.3);
            z-index: 100;
            border-radius: 0 8px 8px 0;
        }

        /* Textura de cuero/libro */
        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                repeating-linear-gradient(0deg,
                    transparent,
                    transparent 1px,
                    rgba(255, 255, 255, 0.02) 1px,
                    rgba(255, 255, 255, 0.02) 2px);
            pointer-events: none;
            z-index: 1;
        }

        /* Borde dorado interior */
        .cover-page::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 2px solid rgba(201, 162, 39, 0.4);
            border-radius: 4px;
            pointer-events: none;
            z-index: 2;
        }

        /* Encabezado universitario - SIN CAJA, LOGOS EN EXTREMOS */
        .notebook-label {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 15px 10px;
            box-shadow: none;
            z-index: 10;
            margin-top: 10px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .notebook-label .logo-inline {
            width: 90px;
            height: 90px;
            border-radius: 8px;
            object-fit: contain;
            border: 3px solid #c9a227;
            background: white;
            padding: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
        }

        .notebook-label-text {
            text-align: center;
            flex: 1;
        }

        .cover-title {
            font-family: 'Grenze Gotisch', Georgia, serif;
            font-size: clamp(26px, 3.2vw, 36px);
            font-weight: 700;
            color: #c9a227;
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
            text-align: center;
            line-height: 1.2;
        }

        .cover-subtitle {
            font-family: 'Grenze Gotisch', Georgia, serif;
            font-size: clamp(14px, 1.6vw, 20px);
            color: #a89060;
            margin: 4px 0 0 0;
            text-align: center;
            font-weight: 700;
            line-height: 1.2;
        }

        /* Ocultar elementos no necesarios */
        .notebook-subtitle-label,
        .logo-spaces,
        .logo-space,
        .corner-decoration,
        .notebook-decoration {
            display: none !important;
        }

        /* T铆tulo principal del curso - GRANDE Y ELEGANTE */
        .course-info {
            background: transparent;
            border: none;
            padding: 10px 20px;
            box-shadow: none;
            z-index: 10;
            width: min(500px, calc(100% - 50px));
            text-align: center;
            margin-top: 15px;
        }

        .course-title {
            font-family: 'Grenze Gotisch', Georgia, serif;
            font-size: clamp(36px, 5.5vw, 60px);
            font-weight: 700;
            font-style: normal;
            color: #c9a227;
            text-shadow:
                3px 3px 6px rgba(0, 0, 0, 0.7),
                0 0 25px rgba(201, 162, 39, 0.5);
            margin-bottom: 20px;
            letter-spacing: 4px;
            display: block;
            white-space: nowrap;
        }

        .course-title::before {
            content: none;
        }

        .course-details {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            font-family: 'Grenze Gotisch', Georgia, serif;
            font-size: clamp(18px, 2.2vw, 26px);
            font-weight: 700;
            color: #c9a227;
        }

        .course-details span {
            display: block;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .course-details strong {
            color: #e8d4a8;
            font-weight: 600;
        }

        /* Secci贸n de estudiantes - ESTILO ELEGANTE */
        .students-container {
            background: transparent;
            border: none;
            padding: 8px 20px;
            box-shadow: none;
            z-index: 10;
            width: min(500px, calc(100% - 50px));
            margin-top: 5px;
        }

        .students-title {
            display: none;
        }

        .students-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: center;
            margin-bottom: 0;
        }

        .student-card {
            background: transparent;
            border: none;
            padding: 0;
            box-shadow: none;
            display: block;
            text-align: center;
            min-width: auto;
            max-width: none;
        }

        .student-card:hover {
            transform: none;
            box-shadow: none;
        }

        .student-icon {
            display: none;
        }

        .student-name {
            font-family: 'Grenze Gotisch', Georgia, serif;
            font-size: clamp(18px, 2.2vw, 26px);
            font-weight: 700;
            color: #c9a227;
            line-height: 1.4;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
        }

        .student-name::before {
            content: 'Estudiante: ';
            color: #a89060;
        }

        /* Botones de acceso a unidades */
        .unit-access-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 15px;
            z-index: 10;
        }

        .unit-btn {
            font-family: 'Grenze Gotisch', Georgia, serif;
            font-size: clamp(16px, 1.8vw, 22px);
            font-weight: 700;
            padding: 12px 30px;
            background: linear-gradient(180deg, rgba(201, 162, 39, 0.2) 0%, rgba(201, 162, 39, 0.1) 100%);
            border: 2px solid #c9a227;
            border-radius: 8px;
            color: #c9a227;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 15px rgba(201, 162, 39, 0.2);
        }

        .unit-btn:hover {
            background: linear-gradient(180deg, rgba(201, 162, 39, 0.4) 0%, rgba(201, 162, 39, 0.2) 100%);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(201, 162, 39, 0.4);
        }

        .unit-btn:active {
            transform: translateY(0);
        }

        /* Ocultar botones antiguos */
        .start-buttons-inner,
        .start-buttons {
            display: none !important;
        }

        /* Mantener estilos antiguos por compatibilidad */
        .student-info {
            display: none;
        }

        /* Decoraciones del cuaderno - REPOSICIONADAS */
        .notebook-decoration {
            position: absolute;
            z-index: 2;
        }

        .decoration-1 {
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ef4444, #dc2626);
            border-radius: 50%;
            transform: rotate(-15deg);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .decoration-1::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }

        .decoration-2 {
            bottom: 20px;
            left: 25px;
            width: 60px;
            height: 30px;
            background: linear-gradient(45deg, #10b981, #059669);
            border-radius: 15px;
            transform: rotate(10deg);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .decoration-2::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }

        /* Esquinas del cuaderno - MS PEQUEAS */
        .corner-decoration {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            z-index: 2;
        }

        .corner-top-left {
            top: 0;
            left: 0;
            clip-path: polygon(0 0, 100% 0, 0 100%);
        }

        .corner-top-right {
            top: 0;
            right: 0;
            clip-path: polygon(100% 0, 100% 100%, 0 0);
        }

        .corner-bottom-left {
            bottom: 0;
            left: 0;
            clip-path: polygon(0 0, 100% 100%, 0 100%);
        }

        .corner-bottom-right {
            bottom: 0;
            right: 0;
            clip-path: polygon(100% 0, 100% 100%, 0 100%);
        }

        /* Botones de navegaci贸n - ULTRA COMPACTOS */
        .start-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            z-index: 10;
            width: min(620px, calc(100% - 36px));
            margin: 4px auto 0 auto;
        }

        .start-btn {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 10px;
            font-family: 'Caveat', cursive;
            font-size: clamp(13px, 1.6vw, 16px);
            font-weight: 600;
            cursor: pointer;
            box-shadow:
                0 3px 10px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: rotate(-1deg);
            position: relative;
            overflow: hidden;
            min-width: 100px;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .start-btn:hover {
            transform: rotate(0deg) translateY(-3px);
            box-shadow:
                0 12px 25px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .start-btn:nth-child(2) {
            transform: rotate(2deg);
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            box-shadow:
                0 8px 20px rgba(139, 92, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .start-btn:nth-child(3) {
            transform: rotate(-1deg);
            background: linear-gradient(145deg, #10b981, #059669);
            box-shadow:
                0 8px 20px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                bottom: 20px;
                left: 50%;
                top: auto;
                transform: translateX(-50%);
                flex-direction: row;
                padding: 15px 20px;
                gap: 15px;
                width: calc(100vw - 40px);
                max-width: 600px;
                flex-wrap: wrap;
            }

            .nav-btn {
                flex: 1;
                min-width: 80px;
                padding: 12px 15px;
                font-size: 12px;
            }

            .notebook-container {
                transform: rotate(0deg);
                margin-left: auto;
                margin-bottom: 120px;
                width: calc(100vw - 40px);
                max-width: none;
            }

            .page-content {
                padding: 30px 30px 30px 120px;
                line-height: 26px;
            }

            /* Ajustes adicionales en m贸viles */
            .logo-spaces {
                padding: 0 14px;
                top: 10px;
            }

            .notebook-label {
                width: calc(100% - 40px);
                margin-top: 18px;
            }

            .student-info {
                width: calc(100% - 40px);
                transform: rotate(0.5deg);
            }

            .start-buttons {
                width: calc(100% - 40px);
                gap: 10px;
            }
        }

        /* Estilos de impresi贸n - Cuaderno real A5 */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            @page {
                size: A4 portrait;
                margin: 8mm;
            }

            @media print {

                html,
                body {
                    width: 210mm;
                    height: 297mm;
                }
            }

            body {
                background: white !important;
                overflow: visible !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                font-family: 'Kalam', cursive;
            }

            .sidebar,
            .notebook-container,
            .notebook,
            .spiral-binding {
                display: none !important;
            }

            .print-container {
                display: block !important;
                width: 100% !important;
                height: 100% !important;
            }

            .print-page {
                width: 100%;
                height: 48vh;
                border: 2px solid #333;
                margin-bottom: 4mm;
                padding: 0;
                box-sizing: border-box;
                background:
                    linear-gradient(90deg, transparent 0px, transparent 25px, #ff6b6b 25px, #ff6b6b 27px, transparent 27px),
                    repeating-linear-gradient(transparent, transparent 18px, #e3f2fd 18px, #e3f2fd 20px);
                background-color: #fefefe;
                position: relative;
                page-break-inside: avoid;
            }

            .print-page:last-child {
                margin-bottom: 0;
            }

            .print-page-header {
                background: linear-gradient(145deg, #fef3c7, #fde68a);
                border-bottom: 2px solid #d97706;
                padding: 8px 15px;
                margin: 0;
                font-family: 'Caveat', cursive;
                font-size: 14px;
                font-weight: bold;
                color: #92400e;
                text-align: center;
            }

            .print-page-content {
                padding: 15px 15px 15px 35px;
                height: calc(100% - 50px);
                overflow: visible;
                font-size: 11px;
                line-height: 20px;
                color: #2d3748;
            }

            /* Estilos para im谩genes en impresi贸n */
            .two-column-layout {
                display: flex !important;
                gap: 15px !important;
                margin: 10px 0 !important;
                page-break-inside: avoid;
            }

            .column-left,
            .column-right {
                flex: 1 !important;
            }

            .column-image {
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                page-break-inside: avoid;
                display: block !important;
            }

            .image-caption {
                font-size: 9px !important;
                text-align: center !important;
                margin-top: 3px !important;
                color: #666 !important;
            }

            .graph-container {
                margin: 10px 0 !important;
                text-align: center !important;
                page-break-inside: avoid;
            }

            .graph-container img {
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                display: block !important;
            }

            /* Forzar visualizaci贸n de todas las im谩genes */
            img {
                display: block !important;
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                margin: 5px auto !important;
                page-break-inside: avoid !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* Asegurar que las im谩genes dentro de contenedores tambi茅n aparezcan */
            .print-page img,
            .print-page-content img,
            .two-column-layout img,
            .column-left img,
            .column-right img,
            .column-image,
            .graph-container img {
                display: block !important;
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                margin: 5px auto !important;
                page-break-inside: avoid !important;
                visibility: visible !important;
                opacity: 1 !important;
                background: white !important;
            }

            .print-page-number {
                position: absolute;
                bottom: 8px;
                right: 15px;
                font-size: 10px;
                color: #666;
                border: 1px solid #666;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(255, 255, 255, 0.8);
            }

            /* Estilos espec铆ficos para elementos del cuaderno */
            .print-page .handwritten-title {
                font-family: 'Caveat', cursive !important;
                font-size: 16px !important;
                font-weight: bold !important;
                color: #1e40af !important;
                margin: 15px 0 10px 0 !important;
                text-decoration: underline;
            }

            .print-page .formula-box {
                border: 2px dashed #8e24aa !important;
                background: linear-gradient(135deg, #f3e5f5, #e1bee7) !important;
                padding: 10px !important;
                margin: 12px 0 !important;
                text-align: center !important;
                font-family: 'Caveat', cursive !important;
                font-size: 14px !important;
                font-weight: bold !important;
                color: #4a148c !important;
                border-radius: 8px;
            }

            .print-page .handwritten-text {
                margin: 8px 0 !important;
                line-height: 20px !important;
                font-size: 11px !important;
            }

            .print-page .handwritten-table {
                width: 100% !important;
                border-collapse: collapse !important;
                margin: 10px 0 !important;
                font-size: 10px !important;
            }

            .print-page .handwritten-table th {
                background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
                color: white !important;
                padding: 6px !important;
                border: 1px solid #1e40af !important;
                font-weight: bold !important;
            }

            .print-page .handwritten-table td {
                padding: 5px !important;
                border: 1px solid #94a3b8 !important;
                background: rgba(255, 255, 255, 0.7) !important;
            }

            .print-page .info-box,
            .print-page .warning-box,
            .print-page .success-box,
            .print-page .example-box,
            .print-page .definition-box {
                border: 2px solid #0288d1 !important;
                background: linear-gradient(135deg, #e0f2fe, #b3e5fc) !important;
                padding: 8px !important;
                margin: 10px 0 !important;
                border-radius: 8px !important;
                font-size: 10px !important;
            }

            .print-page .highlighted-note {
                background: linear-gradient(120deg, #fef3c7, #fde68a) !important;
                border-left: 4px solid #f59e0b !important;
                padding: 8px !important;
                margin: 10px 0 !important;
                font-style: italic !important;
            }



            /* Re-aplicar estilos espec铆ficos despu茅s del revert */
            .print-page img {
                display: block !important;
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                margin: 5px auto !important;
                page-break-inside: avoid !important;
            }

            .print-page .two-column-layout {
                display: flex !important;
                gap: 15px !important;
                margin: 10px 0 !important;
                page-break-inside: avoid !important;
            }

            .print-page .column-left,
            .print-page .column-right {
                flex: 1 !important;
            }

            /* Logo FIE en impresi贸n */
            .print-page .fie-logo {
                position: absolute !important;
                top: 8px !important;
                right: 12px !important;
                width: 35px !important;
                height: auto !important;
                z-index: 15 !important;
                opacity: 0.7 !important;
                border-radius: 4px !important;
            }
        }

        .print-container {
            display: none;
        }
    </style>
    <!-- Optimizaci贸n de espacios e interacci贸n: estilos adicionales -->
    <style>
        .interaction-toggle {
            position: fixed;
            right: 24px;
            bottom: 24px;
            padding: 10px 14px;
            border-radius: 12px;
            border: none;
            background: #4e7cff;
            color: #fff;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            cursor: pointer;
            z-index: 1000;
            font-weight: 600;
        }

        .interaction-toggle:hover {
            filter: brightness(1.05);
        }

        .floating-actions {
            position: fixed;
            left: 16px;
            bottom: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }

        .fab {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background: #00b894;
            color: #fff;
            font-size: 20px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
            cursor: pointer;
        }

        .fab:hover {
            filter: brightness(1.06);
        }

        /* Ocultar barra lateral en pantallas peque帽as y usar acciones flotantes */
        @media (max-width: 768px) {

            .sidebar,
            .side-menu,
            .nav-sidebar {
                display: none !important;
            }

            .floating-actions {
                display: flex;
            }
        }

        @media (min-width: 769px) {
            .floating-actions {
                display: none;
            }
        }

        /* ============================================= */
        /* ESTILOS RESPONSIVOS COMPLETOS */
        /* ============================================= */

        /* === TABLETS (768px - 1024px) === */
        @media (max-width: 1024px) and (min-width: 769px) {
            .notebook-container {
                max-width: calc(100vw - 180px);
                width: calc(100vw - 180px);
                margin-left: 160px;
            }

            .page-content {
                padding: 30px 40px 50px 140px;
                line-height: 26px;
            }

            .handwritten-title {
                font-size: 24px;
            }

            .handwritten-text {
                font-size: 13px;
                line-height: 26px;
            }

            .sidebar {
                left: 10px;
                padding: 18px 12px;
            }

            .nav-btn {
                padding: 12px 15px;
                font-size: 12px;
                min-width: 100px;
            }

            .fie-logo {
                width: 55px;
            }
        }

        /* === MVILES Y TABLETS PEQUEAS (max 768px) === */
        @media (max-width: 768px) {

            html,
            body {
                overflow-x: hidden;
                overflow-y: auto;
                height: auto;
            }

            body {
                padding-bottom: 80px;
            }

            .sidebar {
                position: fixed;
                bottom: 10px;
                left: 50%;
                top: auto;
                transform: translateX(-50%);
                flex-direction: row;
                padding: 10px 15px;
                gap: 10px;
                width: calc(100vw - 20px);
                max-width: 500px;
                flex-wrap: wrap;
                justify-content: center;
                border-radius: 15px;
                z-index: 1000;
            }

            .nav-menu {
                width: 100%;
                margin-bottom: 5px;
            }

            .nav-menu-btn {
                width: 100%;
                font-size: 12px;
                padding: 10px 15px;
            }

            .nav-dropdown {
                max-height: 60vh;
                bottom: 100%;
                top: auto;
                margin-bottom: 10px;
            }

            .nav-btn {
                flex: 1 1 auto;
                min-width: 70px;
                padding: 10px 12px;
                font-size: 11px;
            }

            .notebook-container {
                width: 100vw;
                max-width: 100vw;
                height: auto;
                min-height: calc(100vh - 100px);
                margin: 0;
                padding: 0;
                animation: none;
            }

            .notebook {
                border-radius: 0;
                padding: 10px;
                border-width: 2px;
            }

            .spiral-binding {
                display: none;
            }

            .notebook-page {
                width: 100%;
                height: auto;
                min-height: calc(100vh - 150px);
                margin-left: 0;
                border-radius: 0;
                /* Quitar la l铆nea roja del margen en m贸vil */
                background:
                    repeating-linear-gradient(transparent,
                        transparent 29px,
                        #e3f2fd 29px,
                        #e3f2fd 31px);
                background-color: #fefefe;
            }


            .notebook-page::before,
            .notebook-page::after {
                display: none;
            }

            .page-content {
                padding: 20px 15px 80px 15px;
                line-height: 24px;
                overflow-y: auto;
                height: auto;
                min-height: calc(100vh - 180px);
            }

            /* Tipograf铆a m贸vil */
            .handwritten-title {
                font-size: 20px;
                margin-bottom: 12px;
            }

            .handwritten-text {
                font-size: 13px;
                line-height: 24px;
            }

            .handwritten-text p {
                margin-bottom: 12px;
            }

            .handwritten-text ul,
            .handwritten-text ol {
                padding-left: 20px;
                margin-bottom: 12px;
            }

            .handwritten-text li {
                margin-bottom: 6px;
            }

            /* Tablas responsivas */
            table,
            .data-table,
            .handwritten-table {
                display: block;
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                font-size: 11px;
            }

            table th,
            table td,
            .data-table th,
            .data-table td,
            .handwritten-table th,
            .handwritten-table td {
                padding: 6px 8px;
                font-size: 11px;
                white-space: nowrap;
            }

            /* Cajas y f贸rmulas */
            .formula-box,
            .handwritten-formula {
                padding: 10px;
                font-size: 14px;
                margin: 12px 0;
                overflow-x: auto;
            }

            .ejemplo-box,
            .resumen-box,
            .ejercicio-box {
                padding: 12px;
                margin: 12px 0;
                font-size: 12px;
            }

            .highlighted-note,
            .info-box,
            .warning-box {
                padding: 10px;
                margin: 10px 0;
                font-size: 12px;
            }

            /* Logo FIE en m贸vil */
            .fie-logo {
                width: 45px;
                top: 8px;
                right: 10px;
            }

            /* N煤mero de p谩gina */
            .page-number {
                bottom: 70px;
                right: 15px;
                width: 35px;
                height: 35px;
                font-size: 14px;
            }

            /* Portada en m贸vil */
            .cover-page {
                left: -10px;
                right: -10px;
                top: -10px;
                bottom: -10px;
                padding: 20px 15px;
                gap: 12px;
            }

            .notebook-label {
                width: 100%;
                padding: 8px;
                font-size: 10px;
            }

            .cover-main-title {
                font-size: 20px !important;
            }

            .cover-subtitle {
                font-size: 14px !important;
            }

            .student-info {
                width: 100%;
                padding: 15px;
            }

            .student-info p {
                font-size: 12px;
            }

            .start-buttons {
                width: 100%;
                flex-direction: column;
                gap: 10px;
            }

            .start-btn,
            .unit-btn {
                width: 100%;
                padding: 12px 15px;
                font-size: 14px;
            }

            /* Im谩genes responsivas */
            .two-column-layout {
                flex-direction: column;
                gap: 15px;
            }

            .column-image,
            .graph-container img,
            img {
                max-width: 100%;
                height: auto;
            }

            /* Floating actions */
            .floating-actions {
                bottom: 80px;
            }
        }

        /* === MVILES PEQUEOS (max 480px) === */
        @media (max-width: 480px) {
            .page-content {
                padding: 15px 10px 90px 10px;
                line-height: 22px;
            }

            .handwritten-title {
                font-size: 18px;
                margin-bottom: 10px;
            }

            .handwritten-text {
                font-size: 12px;
                line-height: 22px;
            }

            .sidebar {
                padding: 8px 10px;
                gap: 8px;
            }

            .nav-btn {
                padding: 8px 10px;
                font-size: 10px;
                min-width: 60px;
            }

            .nav-menu-btn {
                font-size: 11px;
                padding: 8px 12px;
            }

            .formula-box,
            .handwritten-formula {
                padding: 8px;
                font-size: 12px;
            }

            table th,
            table td,
            .data-table th,
            .data-table td {
                padding: 4px 6px;
                font-size: 10px;
            }

            .fie-logo {
                width: 35px;
            }

            .cover-main-title {
                font-size: 16px !important;
            }

            .cover-subtitle {
                font-size: 12px !important;
            }

            .student-info p {
                font-size: 11px;
            }

            .start-btn,
            .unit-btn {
                font-size: 12px;
                padding: 10px 12px;
            }
        }

        /* === MODO LANDSCAPE EN MVILES === */
        @media (max-width: 900px) and (orientation: landscape) {
            .notebook-container {
                min-height: 100vh;
            }

            .page-content {
                padding: 15px 20px 70px 20px;
            }

            .sidebar {
                padding: 8px 15px;
            }

            .cover-page {
                overflow-y: auto;
            }
        }

        /* === PANTALLAS GRANDES (1440px+) === */
        @media (min-width: 1440px) {
            .notebook-container {
                max-width: 1200px;
                margin-left: auto;
                margin-right: auto;
                padding-left: 170px;
            }

            .page-content {
                padding: 50px 60px 70px 180px;
            }

            .handwritten-title {
                font-size: 32px;
            }

            .handwritten-text {
                font-size: 16px;
                line-height: 32px;
            }
        }

        /* === AJUSTES DE ACCESIBILIDAD === */
        @media (prefers-reduced-motion: reduce) {
            .notebook-container {
                animation: none;
            }

            .page-flipping {
                animation: none;
            }

            * {
                transition-duration: 0.01ms !important;
                animation-duration: 0.01ms !important;
            }
        }

        /* ========================================
           NAVEGACIN MODERNA - FAB & GESTURES
        ======================================== */

        /* FAB Navigation Buttons */
        .fab-nav {
            position: fixed;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), 0 2px 4px rgba(0, 0, 0, 0.12);
            font-size: 24px;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .fab-nav:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25), 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .fab-nav:active {
            transform: scale(0.95);
        }

        .fab-nav:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .fab-nav.fab-prev {
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .fab-nav.fab-prev:hover:not(:disabled) {
            transform: translateY(-50%) scale(1.1);
        }

        .fab-nav.fab-next {
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .fab-nav.fab-next:hover:not(:disabled) {
            transform: translateY(-50%) scale(1.1);
        }

        /* Progress Indicator */
        .progress-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .progress-dots {
            display: flex;
            gap: 6px;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #e0e0e0;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 24px;
            border-radius: 4px;
        }

        .progress-dot:hover {
            background: #bdbdbd;
            transform: scale(1.2);
        }

        .progress-dot.active:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .progress-text {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            font-size: 12px;
            color: #666;
            font-weight: 500;
            margin-left: 12px;
            min-width: 60px;
            text-align: center;
        }

        /* Quick Menu FAB */
        .fab-menu {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 1001;
        }

        .fab-menu-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .fab-menu-btn:hover {
            transform: scale(1.1) rotate(90deg);
        }

        .fab-menu-items {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .fab-menu.open .fab-menu-items {
            opacity: 1;
            visibility: visible;
        }

        .fab-menu-item {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: white;
            color: #333;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab-menu-item:hover {
            transform: scale(1.1);
            background: #f5f5f5;
        }

        .fab-menu-item-label {
            position: absolute;
            right: 60px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .fab-menu-item:hover .fab-menu-item-label {
            opacity: 1;
        }

        /* Page Flip Animation - Enhanced */
        .page-flip-next {
            animation: pageFlipNext 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-flip-prev {
            animation: pageFlipPrev 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes pageFlipNext {
            0% {
                transform: perspective(1500px) rotateY(0deg);
                transform-origin: left center;
            }

            50% {
                transform: perspective(1500px) rotateY(-15deg);
                transform-origin: left center;
            }

            100% {
                transform: perspective(1500px) rotateY(0deg);
                transform-origin: left center;
            }
        }

        @keyframes pageFlipPrev {
            0% {
                transform: perspective(1500px) rotateY(0deg);
                transform-origin: right center;
            }

            50% {
                transform: perspective(1500px) rotateY(15deg);
                transform-origin: right center;
            }

            100% {
                transform: perspective(1500px) rotateY(0deg);
                transform-origin: right center;
            }
        }

        /* Slide Animation Alternative */
        .page-slide-next {
            animation: slideNext 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page-slide-prev {
            animation: slidePrev 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideNext {
            0% {
                opacity: 1;
                transform: translateX(0);
            }

            50% {
                opacity: 0;
                transform: translateX(-50px);
            }

            51% {
                transform: translateX(50px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slidePrev {
            0% {
                opacity: 1;
                transform: translateX(0);
            }

            50% {
                opacity: 0;
                transform: translateX(50px);
            }

            51% {
                transform: translateX(-50px);
            }

            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Swipe Indicator */
        .swipe-indicator {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 999;
        }

        .swipe-indicator.left {
            left: 0;
            background: linear-gradient(90deg, rgba(102, 126, 234, 0.3), transparent);
        }

        .swipe-indicator.right {
            right: 0;
            background: linear-gradient(-90deg, rgba(102, 126, 234, 0.3), transparent);
        }

        .swipe-indicator.visible {
            opacity: 1;
        }

        .swipe-indicator svg {
            width: 30px;
            height: 30px;
            fill: #667eea;
        }

        /* Keyboard Hint */
        .keyboard-hint {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-family: 'Inter', sans-serif;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }

        .keyboard-hint.visible {
            animation: fadeInOut 3s ease;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
            }

            15% {
                opacity: 1;
            }

            85% {
                opacity: 1;
            }

            100% {
                opacity: 0;
            }
        }

        .keyboard-hint kbd {
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            margin: 0 4px;
        }

        /* Mobile Adjustments for FAB */
        @media (max-width: 768px) {

            .fab-nav.fab-prev,
            .fab-nav.fab-next {
                display: none !important;
                visibility: hidden !important;
            }

            .progress-container {
                bottom: 90px;
                padding: 8px 16px;
            }

            .progress-text {
                font-size: 11px;
            }

            .fab-menu {
                bottom: 90px;
            }

            /* Touch swipe area indicator */
            .touch-zone {
                position: fixed;
                top: 50%;
                transform: translateY(-50%);
                width: 40px;
                height: 150px;
                z-index: 998;
            }

            .touch-zone.left {
                left: 0;
            }

            .touch-zone.right {
                right: 0;
            }
        }

        /* Hide old sidebar on mobile when using new nav */
        @media (max-width: 768px) {
            .sidebar {
                display: none !important;
            }
        }

        /* ========================================
           ESTILOS NAVEGACIN MODERNA
        ======================================== */

        /* FAB Navigation Buttons */
        .fab-nav {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            display: flex;
        }

        .fab-nav:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }

        .fab-nav:active {
            transform: translateY(-50%) scale(0.95);
        }

        .fab-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .fab-prev {
            left: 20px;
        }

        .fab-next {
            right: 20px;
        }

        /* Progress Indicator */
        .progress-container {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .progress-dots {
            display: flex;
            gap: 6px;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #d1d5db;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .progress-dot:hover {
            background: #9ca3af;
            transform: scale(1.2);
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transform: scale(1.3);
        }

        .progress-text {
            font-family: 'Inter', sans-serif;
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            min-width: 60px;
            text-align: center;
        }

        /* FAB Menu */
        .fab-menu {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1001;
            display: block;
        }

        .fab-menu-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .fab-menu-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.6);
        }

        .fab-menu-items {
            position: absolute;
            bottom: 70px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }

        .fab-menu.open .fab-menu-items {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .fab-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            border: none;
            padding: 12px 16px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .fab-menu-item:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        .fab-menu-item-label {
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        /* Swipe Indicators */
        .swipe-indicator {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 999;
        }

        .swipe-indicator.left {
            left: 20px;
        }

        .swipe-indicator.right {
            right: 20px;
        }

        .swipe-indicator.visible {
            opacity: 1;
        }

        .swipe-indicator svg {
            width: 30px;
            height: 30px;
            fill: #667eea;
        }

        /* Keyboard Hint */
        .keyboard-hint {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(31, 41, 55, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1002;
        }

        .keyboard-hint.visible {
            opacity: 1;
            visibility: visible;
        }

        .keyboard-hint kbd {
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 8px;
            border-radius: 4px;
            margin: 0 4px;
        }

        /* Ocultar navegaci贸n en la portada */
        body.on-cover .fab-nav,
        body.on-cover .progress-container,
        body.on-cover .fab-menu {
            display: none !important;
        }
    </style>
</head>

<body class="on-cover">
    <!-- Men煤 de navegaci贸n oculto (accesible desde FAB menu) -->
    <div class="nav-dropdown" id="nav-dropdown"
        style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000; background: white; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); padding: 20px; max-height: 80vh; overflow-y: auto; min-width: 320px;">
        <div
            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e5e7eb;">
            <h3 style="margin: 0; font-family: 'Caveat', cursive; font-size: 24px; color: #1f2937;"> Ir a Tema</h3>
            <button onclick="toggleNavMenu()"
                style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;"></button>
        </div>
        <div class="nav-unit">
            <div class="nav-unit-title" onclick="selectUnit(1)"
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 16px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; font-weight: 600;">
                 Unidad I - Macroeconom铆a I</div>
            <div class="nav-pages" style="display: flex; flex-direction: column; gap: 6px; padding-left: 10px;">
                <div class="nav-page-item" onclick="goToPage(1, 0)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer; transition: all 0.2s;">
                     Semana 1: El Mercado de Bienes</div>
                <div class="nav-page-item" onclick="goToPage(1, 10)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 2:
                    Mercado de Dinero</div>
                <div class="nav-page-item" onclick="goToPage(1, 20)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;">锔 Semana 3:
                    Modelo IS-LM</div>
                <div class="nav-page-item" onclick="goToPage(1, 30)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 4:
                    Modelo Mundell-Fleming</div>
                <div class="nav-page-item" onclick="goToPage(1, 40)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 5:
                    Pol铆ticas Tipo de Cambio</div>
                <div class="nav-page-item" onclick="goToPage(1, 50)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 6:
                    Expectativas</div>
                <div class="nav-page-item" onclick="goToPage(1, 60)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 7:
                    Crecimiento Econ贸mico</div>
                <div class="nav-page-item" onclick="goToPage(1, 70)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 8:
                    Mercado de Dinero II</div>
                <div class="nav-page-item" onclick="goToPage(1, 80)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 9:
                    Ciclos Econ贸micos</div>
            </div>
        </div>
        <div class="nav-unit" style="margin-top: 15px;">
            <div class="nav-unit-title" onclick="selectUnit(2)"
                style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 12px 16px; border-radius: 10px; margin-bottom: 10px; cursor: pointer; font-weight: 600;">
                 Unidad II - El Modelo OA-DA</div>
            <div class="nav-pages" style="display: flex; flex-direction: column; gap: 6px; padding-left: 10px;">
                <div class="nav-page-item" onclick="goToPage(2, 0)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 10:
                    Demanda Agregada</div>
                <div class="nav-page-item" onclick="goToPage(2, 10)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 11:
                    Mercado de Trabajo</div>
                <div class="nav-page-item" onclick="goToPage(2, 20)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 12:
                    Oferta Agregada</div>
                <div class="nav-page-item" onclick="goToPage(2, 30)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;">锔 Semana 13:
                    Modelo OA-DA</div>
                <div class="nav-page-item" onclick="goToPage(2, 40)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;">锔 Semana 14:
                    Pol铆ticas Fiscales</div>
                <div class="nav-page-item" onclick="goToPage(2, 50)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 15:
                    Expectativas OA</div>
                <div class="nav-page-item" onclick="goToPage(2, 60)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 16:
                    Curva de Phillips</div>
                <div class="nav-page-item" onclick="goToPage(2, 70)"
                    style="padding: 10px 14px; background: #f8fafc; border-radius: 8px; cursor: pointer;"> Semana 17:
                    D茅ficit Fiscal</div>
            </div>
        </div>
    </div>

    <!-- Overlay para el men煤 -->
    <div id="nav-overlay"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1999;"
        onclick="toggleNavMenu()"></div>

    <!-- Cuaderno -->

    <div class="notebook-container">
        <div class="notebook">
            <!-- Espiral -->
            <div class="spiral-binding"></div>

            <!-- P谩gina actual -->
            <div class="notebook-page" id="current-page">
                <!-- Logo de la FIE -->
                <img src="assets/fie.png" alt="Logo FIE" class="fie-logo" onerror="this.style.display='none'">

                <div class="page-content" id="page-content">
                    <!-- Contenido se carga din谩micamente -->
                </div>
                <div class="page-number" id="page-number">0</div>
            </div>
        </div>
    </div>

    <!-- Contenedor para impresi贸n (oculto en pantalla) -->
    <div class="print-container" id="print-container">
        <!-- Se genera din谩micamente -->
    </div>

    <!-- ========================================
         NAVEGACIN MODERNA
    ======================================== -->

    <!-- FAB Navigation Buttons (Desktop) -->
    <button class="fab-nav fab-prev" id="fab-prev" onclick="previousPageAnimated('flip')" title="P谩gina anterior ()">
        
    </button>
    <button class="fab-nav fab-next" id="fab-next" onclick="nextPageAnimated('flip')" title="P谩gina siguiente ()">
        
    </button>

    <!-- Progress Indicator -->
    <div class="progress-container" id="progress-container">
        <div class="progress-dots" id="progress-dots">
            <!-- Dots generated dynamically -->
        </div>
        <span class="progress-text" id="progress-text">1 / 10</span>
    </div>

    <!-- FAB Menu -->
    <div class="fab-menu" id="fab-menu">
        <button class="fab-menu-btn" onclick="toggleFabMenu()" title="Men煤">
            
        </button>
        <div class="fab-menu-items">
            <button class="fab-menu-item" onclick="goHome()">
                
                <span class="fab-menu-item-label">Portada</span>
            </button>
            <button class="fab-menu-item" onclick="toggleTheme()">
                
                <span class="fab-menu-item-label">Ir a Tema</span>
            </button>
            <button class="fab-menu-item" onclick="autoFlip()">
                
                <span class="fab-menu-item-label">Auto</span>
            </button>
            <button class="fab-menu-item" onclick="printPages()">
                锔
                <span class="fab-menu-item-label">Imprimir</span>
            </button>
        </div>
    </div>

    <!-- Swipe Indicators -->
    <div class="swipe-indicator left" id="swipe-left">
        <svg viewBox="0 0 24 24">
            <path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z" />
        </svg>
    </div>
    <div class="swipe-indicator right" id="swipe-right">
        <svg viewBox="0 0 24 24">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" />
        </svg>
    </div>

    <!-- Keyboard Hint -->
    <div class="keyboard-hint" id="keyboard-hint">
        Usa <kbd></kbd> <kbd></kbd> para navegar
    </div>

    <script>
        // Variables globales
        let currentPageIndex = 0;
        let currentUnit = 0;
        let pages = [];
        let isAutoFlipping = false;

        // Funci贸n para crear sonido de papel
        function createPaperSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();

                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, audioContext.currentTime);
                osc.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.08);

                gain.gain.setValueAtTime(0.003, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.08);

                osc.start();
                osc.stop(audioContext.currentTime + 0.08);

            } catch (e) {
                console.log('Web Audio no disponible');
            }
        }
        // Contenido de las p谩ginas
        const unidades = {
            0: { // Portada
                title: "Portada",
                pages: [
                    {
                        content: `
                            <div class="cover-page">
                                <div class="cover-frame"></div>
                                
                                <!-- Decoraci贸n de fondo -->
                                <svg class="decoration-icon deco-top-right" viewBox="0 0 100 100" fill="none" stroke="white" stroke-width="0.5">
                                    <circle cx="50" cy="50" r="40" stroke-dasharray="5 5" />
                                    <circle cx="50" cy="50" r="30" stroke-opacity="0.5" />
                                    <path d="M50 10 L50 90 M10 50 L90 50" stroke-opacity="0.3" />
                                </svg>
                                
                                <div class="cover-content">
                                    <!-- Encabezado -->
                                    <div class="cover-header">
                                        <img src="assets/una.png" alt="UNA" class="uni-logo" onerror="this.style.display='none'">
                                        <div class="uni-text">
                                            <h2 class="uni-title">Universidad Nacional del Altiplano</h2>
                                            <div class="uni-subtitle">Facultad de Ingenier铆a Econ贸mica</div>
                                            <div class="uni-subtitle" style="font-size: 11px; margin-top: 2px; opacity: 0.8;">Escuela Profesional de Ingenier铆a Econ贸mica</div>
                                        </div>
                                        <img src="assets/fie.png" alt="FIE" class="uni-logo" onerror="this.style.display='none'">
                                    </div>

                                    <!-- T铆tulo Principal -->
                                    <div class="main-title-container">
                                        <h1 class="main-title">Macroeconom铆a I</h1>
                                        <div class="semester-badge">Periodo 2025 - II</div>
                                    </div>

                                    <!-- Docente -->
                                    <div class="teacher-info">
                                        Docente: <span class="teacher-name">M.Sc. Humberto Calizaya Coila</span>
                                    </div>

                                    <!-- Estudiantes -->
                                    <div class="students-box">
                                        <div class="student-badge">
                                            <span class="student-label">Estudiante</span>
                                            <div class="student-val">Edaly Y. Paredes Condori</div>
                                        </div>
                                        <div class="student-badge">
                                            <span class="student-label">Estudiante</span>
                                            <div class="student-val">Yhoselyn M. Nina Mamani</div>
                                        </div>
                                    </div>

                                    <!-- Botones -->
                                    <div class="cover-buttons">
                                        <button class="glow-btn" onclick="selectUnit(1)"> Unidad I</button>
                                        <button class="glow-btn" onclick="selectUnit(2)"> Unidad II</button>
                                    </div>
                                </div>
                            </div>
                        `

                    }
                ]
            },
            2: { // Unidad II
                title: "Unidad II: El Modelo OA-DA",
                pages: Array.from({ length: 80 }, () => ({}))
            },



            /* P谩gina removida: Tramo final de Unidad I (contenido inline eliminado) */

            1: { // Unidad I
                title: "Unidad I: Modelo IS-LM y Mundell-Fleming",
                pages: Array.from({ length: 90 }, () => ({}))
            },

        };

        // Slim: sobrescribe p谩ginas para evitar duplicidad y usar archivos externos
        try {
            if (unidades && unidades[1]) {
                unidades[1].pages = Array.from({ length: 90 }, () => ({}));
            }
            if (unidades && unidades[2]) {
                unidades[2].pages = Array.from({ length: 80 }, () => ({}));
            }
        } catch (e) {
            console.warn('No se pudo simplificar p谩ginas de unidades:', e);
        }

        // Funci贸n para cargar contenido
        function loadContent() {
            const unit = unidades[currentUnit];
            if (!unit || !unit.pages[currentPageIndex]) {
                document.getElementById('page-content').innerHTML = '<div class="handwritten-text">P谩gina no encontrada</div>';
                return;
            }

            const page = unit.pages[currentPageIndex];
            const pageContentEl = document.getElementById('page-content');
            const unitResources = {
                1: { assetsBase: '/assets/unidad1/', docsBase: '/content/unidad1/' },
                2: { assetsBase: '/assets/unidad2/', docsBase: '/content/unidad2/' }
            };
            const resources = unitResources[currentUnit] || null;

            function rewriteRelativeAssets(container, shouldRewrite) {
                if (!shouldRewrite || !resources) return;
                const prefix = (p) => p ? p : '';
                // Im谩genes
                container.querySelectorAll('img[src]').forEach(img => {
                    const origSrc = img.getAttribute('src');
                    if (!origSrc) return;
                    const isExternal = /^(https?:\/\/|data:)/.test(origSrc);
                    const hasFolder = origSrc.includes('/');
                    if (!isExternal && !hasFolder) {
                        const targetSrc = prefix(resources.assetsBase) + origSrc;
                        img.setAttribute('src', targetSrc);
                        try { console.log('[img-rewrite]', { unit: currentUnit, orig: origSrc, final: img.getAttribute('src') }); } catch { }
                    }

                    // Fallback si falla la carga (intenta rutas alternativas b谩sicas)
                    img.addEventListener('error', function onErr() {
                        const fileName = (img.getAttribute('src') || '').split('/').pop();
                        const tries = img.getAttribute('data-fallback-tries') || '0';
                        const n = parseInt(tries, 10) || 0;
                        // Solo intentamos en la carpeta de assets; evitar '/content/...'
                        const candidates = [
                            (prefix(resources.assetsBase) + fileName).replace(/\/\/+/, '/')
                        ];
                        if (n < candidates.length) {
                            img.setAttribute('src', candidates[n]);
                            img.setAttribute('data-fallback-tries', String(n + 1));
                            try { console.warn('[img-fallback]', { try: n + 1, next: candidates[n] }); } catch { }
                        } else {
                            img.removeEventListener('error', onErr);
                            try { console.error('[img-error-final]', { src: img.getAttribute('src') }); } catch { }
                            // Fallback final: cargar como blob y usar ObjectURL
                            (async () => {
                                const abs = (prefix(resources.assetsBase) + fileName).replace(/\/\/+/, '/');
                                try {
                                    const resp = await fetch(abs);
                                    if (!resp.ok) throw new Error('No se pudo descargar imagen: ' + abs);
                                    const blob = await resp.blob();
                                    const url = URL.createObjectURL(blob);
                                    img.setAttribute('src', url);
                                    img.setAttribute('data-object-url', '1');
                                    try { console.warn('[img-blob-fallback]', { from: abs }); } catch { }
                                    img.addEventListener('load', () => {
                                        try { URL.revokeObjectURL(url); } catch { }
                                        img.removeAttribute('data-object-url');
                                    }, { once: true });
                                } catch (e) {
                                    // Si incluso el blob falla, renderizar como background-image
                                    try {
                                        const div = document.createElement('div');
                                        div.className = 'image-fallback';
                                        const alt = img.getAttribute('alt') || '';
                                        div.setAttribute('role', 'img');
                                        div.setAttribute('aria-label', alt);
                                        div.style.backgroundImage = `url(${abs})`;
                                        img.replaceWith(div);
                                        console.warn('[img-background-fallback]', { from: abs });
                                    } catch (ee) {
                                        try { console.error('[img-background-error]', ee); } catch { }
                                    }
                                }
                            })();
                        }
                    });
                });
                // Video sources
                container.querySelectorAll('source[src]').forEach(srcEl => {
                    const src = srcEl.getAttribute('src');
                    if (!src) return;
                    if (/^(https?:\/\/|\.\/|\/)/.test(src) || src.includes('/')) return;
                    srcEl.setAttribute('src', prefix(resources.assetsBase) + src);
                });
                // Document links (pdf/doc/ppt) y otros enlaces sin slash
                container.querySelectorAll('a[href]').forEach(a => {
                    const href = a.getAttribute('href');
                    if (!href) return;
                    if (/^(https?:\/\/|mailto:|tel:|#|\.\/|\/)/.test(href) || href.includes('/')) return;
                    const isDoc = /\.(pdf|docx?|pptx?|xlsx?)$/i.test(href);
                    a.setAttribute('href', prefix(isDoc ? resources.docsBase : resources.assetsBase) + href);
                });
                // iframes (videos/documentos)
                container.querySelectorAll('iframe[src]').forEach(iframe => {
                    const src = iframe.getAttribute('src');
                    if (!src) return;
                    if (/^(https?:\/\/|\.\/|\/)/.test(src) || src.includes('/')) return;
                    const isDoc = /\.(pdf|docx?|pptx?|xlsx?)$/i.test(src);
                    iframe.setAttribute('src', prefix(isDoc ? resources.docsBase : resources.assetsBase) + src);
                });
            }
            const externalMap = {
                // Unidad I: Semana 1 (p谩ginas 1-10)
                '1:0': 'content/unidad1/semana1.html#page-1',
                '1:1': 'content/unidad1/semana1.html#page-2',
                '1:2': 'content/unidad1/semana1.html#page-3',
                '1:3': 'content/unidad1/semana1.html#page-4',
                '1:4': 'content/unidad1/semana1.html#page-5',
                '1:5': 'content/unidad1/semana1.html#page-6',
                '1:6': 'content/unidad1/semana1.html#page-7',
                '1:7': 'content/unidad1/semana1.html#page-8',
                '1:8': 'content/unidad1/semana1.html#page-9',
                '1:9': 'content/unidad1/semana1.html#page-10',
                // Unidad I: Semana 2 (p谩ginas 11-20)
                '1:10': 'content/unidad1/semana2.html#page-1',
                '1:11': 'content/unidad1/semana2.html#page-2',
                '1:12': 'content/unidad1/semana2.html#page-3',
                '1:13': 'content/unidad1/semana2.html#page-4',
                '1:14': 'content/unidad1/semana2.html#page-5',
                '1:15': 'content/unidad1/semana2.html#page-6',
                '1:16': 'content/unidad1/semana2.html#page-7',
                '1:17': 'content/unidad1/semana2.html#page-8',
                '1:18': 'content/unidad1/semana2.html#page-9',
                '1:19': 'content/unidad1/semana2.html#page-10',
                // Unidad I: Semana 3 (p谩ginas 21-30)
                '1:20': 'content/unidad1/semana3.html#page-1',
                '1:21': 'content/unidad1/semana3.html#page-2',
                '1:22': 'content/unidad1/semana3.html#page-3',
                '1:23': 'content/unidad1/semana3.html#page-4',
                '1:24': 'content/unidad1/semana3.html#page-5',
                '1:25': 'content/unidad1/semana3.html#page-6',
                '1:26': 'content/unidad1/semana3.html#page-7',
                '1:27': 'content/unidad1/semana3.html#page-8',
                '1:28': 'content/unidad1/semana3.html#page-9',
                '1:29': 'content/unidad1/semana3.html#page-10',
                // Unidad I: Semana 4 (p谩ginas 31-40)
                '1:30': 'content/unidad1/semana4.html#page-1',
                '1:31': 'content/unidad1/semana4.html#page-2',
                '1:32': 'content/unidad1/semana4.html#page-3',
                '1:33': 'content/unidad1/semana4.html#page-4',
                '1:34': 'content/unidad1/semana4.html#page-5',
                '1:35': 'content/unidad1/semana4.html#page-6',
                '1:36': 'content/unidad1/semana4.html#page-7',
                '1:37': 'content/unidad1/semana4.html#page-8',
                '1:38': 'content/unidad1/semana4.html#page-9',
                '1:39': 'content/unidad1/semana4.html#page-10',
                // Unidad I: Semana 5 (p谩ginas 41-50)
                '1:40': 'content/unidad1/semana5.html#page-1',
                '1:41': 'content/unidad1/semana5.html#page-2',
                '1:42': 'content/unidad1/semana5.html#page-3',
                '1:43': 'content/unidad1/semana5.html#page-4',
                '1:44': 'content/unidad1/semana5.html#page-5',
                '1:45': 'content/unidad1/semana5.html#page-6',
                '1:46': 'content/unidad1/semana5.html#page-7',
                '1:47': 'content/unidad1/semana5.html#page-8',
                '1:48': 'content/unidad1/semana5.html#page-9',
                '1:49': 'content/unidad1/semana5.html#page-10',
                // Unidad I: Semana 6 (p谩ginas 51-60)
                '1:50': 'content/unidad1/semana6.html#page-1',
                '1:51': 'content/unidad1/semana6.html#page-2',
                '1:52': 'content/unidad1/semana6.html#page-3',
                '1:53': 'content/unidad1/semana6.html#page-4',
                '1:54': 'content/unidad1/semana6.html#page-5',
                '1:55': 'content/unidad1/semana6.html#page-6',
                '1:56': 'content/unidad1/semana6.html#page-7',
                '1:57': 'content/unidad1/semana6.html#page-8',
                '1:58': 'content/unidad1/semana6.html#page-9',
                '1:59': 'content/unidad1/semana6.html#page-10',
                // Unidad I: Semana 7 (p谩ginas 61-70)
                '1:60': 'content/unidad1/semana7.html#page-1',
                '1:61': 'content/unidad1/semana7.html#page-2',
                '1:62': 'content/unidad1/semana7.html#page-3',
                '1:63': 'content/unidad1/semana7.html#page-4',
                '1:64': 'content/unidad1/semana7.html#page-5',
                '1:65': 'content/unidad1/semana7.html#page-6',
                '1:66': 'content/unidad1/semana7.html#page-7',
                '1:67': 'content/unidad1/semana7.html#page-8',
                '1:68': 'content/unidad1/semana7.html#page-9',
                '1:69': 'content/unidad1/semana7.html#page-10',
                // Unidad I: Semana 8 (p谩ginas 71-80)
                '1:70': 'content/unidad1/semana8.html#page-1',
                '1:71': 'content/unidad1/semana8.html#page-2',
                '1:72': 'content/unidad1/semana8.html#page-3',
                '1:73': 'content/unidad1/semana8.html#page-4',
                '1:74': 'content/unidad1/semana8.html#page-5',
                '1:75': 'content/unidad1/semana8.html#page-6',
                '1:76': 'content/unidad1/semana8.html#page-7',
                '1:77': 'content/unidad1/semana8.html#page-8',
                '1:78': 'content/unidad1/semana8.html#page-9',
                '1:79': 'content/unidad1/semana8.html#page-10',
                // Unidad I: Semana 9 (p谩ginas 81-90)
                '1:80': 'content/unidad1/semana9.html#page-1',
                '1:81': 'content/unidad1/semana9.html#page-2',
                '1:82': 'content/unidad1/semana9.html#page-3',
                '1:83': 'content/unidad1/semana9.html#page-4',
                '1:84': 'content/unidad1/semana9.html#page-5',
                '1:85': 'content/unidad1/semana9.html#page-6',
                '1:86': 'content/unidad1/semana9.html#page-7',
                '1:87': 'content/unidad1/semana9.html#page-8',
                '1:88': 'content/unidad1/semana9.html#page-9',
                '1:89': 'content/unidad1/semana9.html#page-10',
                // Unidad II: Semana 10 (p谩ginas 1-10)
                '2:0': 'content/unidad2/semana10.html#page-1',
                '2:1': 'content/unidad2/semana10.html#page-2',
                '2:2': 'content/unidad2/semana10.html#page-3',
                '2:3': 'content/unidad2/semana10.html#page-4',
                '2:4': 'content/unidad2/semana10.html#page-5',
                '2:5': 'content/unidad2/semana10.html#page-6',
                '2:6': 'content/unidad2/semana10.html#page-7',
                '2:7': 'content/unidad2/semana10.html#page-8',
                '2:8': 'content/unidad2/semana10.html#page-9',
                '2:9': 'content/unidad2/semana10.html#page-10',
                // Unidad II: Semana 11 (p谩ginas 11-20)
                '2:10': 'content/unidad2/semana11.html#page-1',
                '2:11': 'content/unidad2/semana11.html#page-2',
                '2:12': 'content/unidad2/semana11.html#page-3',
                '2:13': 'content/unidad2/semana11.html#page-4',
                '2:14': 'content/unidad2/semana11.html#page-5',
                '2:15': 'content/unidad2/semana11.html#page-6',
                '2:16': 'content/unidad2/semana11.html#page-7',
                '2:17': 'content/unidad2/semana11.html#page-8',
                '2:18': 'content/unidad2/semana11.html#page-9',
                '2:19': 'content/unidad2/semana11.html#page-10',
                // Unidad II: Semana 12 (p谩ginas 21-30)
                '2:20': 'content/unidad2/semana12.html#page-1',
                '2:21': 'content/unidad2/semana12.html#page-2',
                '2:22': 'content/unidad2/semana12.html#page-3',
                '2:23': 'content/unidad2/semana12.html#page-4',
                '2:24': 'content/unidad2/semana12.html#page-5',
                '2:25': 'content/unidad2/semana12.html#page-6',
                '2:26': 'content/unidad2/semana12.html#page-7',
                '2:27': 'content/unidad2/semana12.html#page-8',
                '2:28': 'content/unidad2/semana12.html#page-9',
                '2:29': 'content/unidad2/semana12.html#page-10',
                // Unidad II: Semana 13 (p谩ginas 31-40)
                '2:30': 'content/unidad2/semana13.html#page-1',
                '2:31': 'content/unidad2/semana13.html#page-2',
                '2:32': 'content/unidad2/semana13.html#page-3',
                '2:33': 'content/unidad2/semana13.html#page-4',
                '2:34': 'content/unidad2/semana13.html#page-5',
                '2:35': 'content/unidad2/semana13.html#page-6',
                '2:36': 'content/unidad2/semana13.html#page-7',
                '2:37': 'content/unidad2/semana13.html#page-8',
                '2:38': 'content/unidad2/semana13.html#page-9',
                '2:39': 'content/unidad2/semana13.html#page-10',
                // Unidad II: Semana 14 (p谩ginas 41-50)
                '2:40': 'content/unidad2/semana14.html#page-1',
                '2:41': 'content/unidad2/semana14.html#page-2',
                '2:42': 'content/unidad2/semana14.html#page-3',
                '2:43': 'content/unidad2/semana14.html#page-4',
                '2:44': 'content/unidad2/semana14.html#page-5',
                '2:45': 'content/unidad2/semana14.html#page-6',
                '2:46': 'content/unidad2/semana14.html#page-7',
                '2:47': 'content/unidad2/semana14.html#page-8',
                '2:48': 'content/unidad2/semana14.html#page-9',
                '2:49': 'content/unidad2/semana14.html#page-10',
                // Unidad II: Semana 15 (p谩ginas 51-60)
                '2:50': 'content/unidad2/semana15.html#page-1',
                '2:51': 'content/unidad2/semana15.html#page-2',
                '2:52': 'content/unidad2/semana15.html#page-3',
                '2:53': 'content/unidad2/semana15.html#page-4',
                '2:54': 'content/unidad2/semana15.html#page-5',
                '2:55': 'content/unidad2/semana15.html#page-6',
                '2:56': 'content/unidad2/semana15.html#page-7',
                '2:57': 'content/unidad2/semana15.html#page-8',
                '2:58': 'content/unidad2/semana15.html#page-9',
                '2:59': 'content/unidad2/semana15.html#page-10',
                // Unidad II: Semana 16 (p谩ginas 61-70)
                '2:60': 'content/unidad2/semana16.html#page-1',
                '2:61': 'content/unidad2/semana16.html#page-2',
                '2:62': 'content/unidad2/semana16.html#page-3',
                '2:63': 'content/unidad2/semana16.html#page-4',
                '2:64': 'content/unidad2/semana16.html#page-5',
                '2:65': 'content/unidad2/semana16.html#page-6',
                '2:66': 'content/unidad2/semana16.html#page-7',
                '2:67': 'content/unidad2/semana16.html#page-8',
                '2:68': 'content/unidad2/semana16.html#page-9',
                '2:69': 'content/unidad2/semana16.html#page-10',
                // Unidad II: Semana 17 (p谩ginas 71-80)
                '2:70': 'content/unidad2/semana17.html#page-1',
                '2:71': 'content/unidad2/semana17.html#page-2',
                '2:72': 'content/unidad2/semana17.html#page-3',
                '2:73': 'content/unidad2/semana17.html#page-4',
                '2:74': 'content/unidad2/semana17.html#page-5',
                '2:75': 'content/unidad2/semana17.html#page-6',
                '2:76': 'content/unidad2/semana17.html#page-7',
                '2:77': 'content/unidad2/semana17.html#page-8',
                '2:78': 'content/unidad2/semana17.html#page-9',
                '2:79': 'content/unidad2/semana17.html#page-10'
            };
            const externalKey = `${currentUnit}:${currentPageIndex}`;
            const externalFile = externalMap[externalKey];
            // Reescritura previa en HTML para evitar primeras cargas err贸neas
            function rewriteHtmlStringAssets(html) {
                if (!resources || !html) return html;
                let out = html;
                function rewriteAttr(tag, attr) {
                    const re = new RegExp(`(<${tag}[^>]*${attr}=["'])([^"']+)(["'])`, 'gi');
                    out = out.replace(re, (m, p1, val, p3) => {
                        if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                        return `${p1}${resources.assetsBase}${val}${p3}`;
                    });
                }
                rewriteAttr('img', 'src');
                rewriteAttr('source', 'src');
                // Enlaces a documentos
                out = out.replace(/(<a[^>]*href=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|mailto:|tel:|#|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                // iframes
                out = out.replace(/(<iframe[^>]*src=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                return out;
            }

            const resolveAndInject = (fileSpec) => {
                const [path, fragment] = fileSpec.split('#');
                return fetch(path)
                    .then(r => r.ok ? r.text() : Promise.reject(new Error('No se pudo cargar ' + path)))
                    .then(html => {
                        try { console.log('[inject]', { path, fragment, unit: currentUnit }); } catch { }
                        if (fragment) {
                            const tmp = document.createElement('div');
                            tmp.innerHTML = html;
                            const node = tmp.querySelector(`#${fragment}`);
                            const fragmentHtml = node ? node.innerHTML : html;
                            pageContentEl.innerHTML = rewriteHtmlStringAssets(fragmentHtml);
                        } else {
                            pageContentEl.innerHTML = rewriteHtmlStringAssets(html);
                        }
                        rewriteRelativeAssets(pageContentEl, true);
                        // Correcci贸n agresiva: forzar rutas de im谩genes a assets/unidadX si siguen sin resolverse
                        (function forceFixImages() {
                            const unitFolder = currentUnit === 1 ? '/assets/unidad1/' : (currentUnit === 2 ? '/assets/unidad2/' : '/assets/');
                            pageContentEl.querySelectorAll('img[src]').forEach(img => {
                                const src = img.getAttribute('src') || '';
                                if (/^https?:\/\//.test(src) || src.startsWith('data:')) return;
                                const fileName = src.split('/').pop();
                                const desired = unitFolder + fileName;
                                if (src !== desired) {
                                    img.setAttribute('src', desired);
                                    try { console.log('[img-force]', { from: src, to: desired }); } catch { }
                                }
                                img.addEventListener('error', () => {
                                    const fallback = desired.startsWith('/') ? desired : ('/' + desired);
                                    img.setAttribute('src', fallback);
                                    try { console.warn('[img-force-fallback]', { to: fallback }); } catch { }
                                }, { once: true });
                            });
                        })();
                        initNotes();
                    })
                    .catch(err => { pageContentEl.innerHTML = '<div class="error-box">' + err.message + '</div>'; });
            };
            if (externalFile) {
                resolveAndInject(externalFile);
            } else if (page.file) {
                resolveAndInject(page.file);
            } else {
                pageContentEl.innerHTML = page.content;
                rewriteRelativeAssets(pageContentEl, false);
                initNotes();
            }
            document.getElementById('page-number').textContent = currentPageIndex + 1;

            // Agregar atributo data-unit para controlar la visibilidad del logo
            const notebookPage = document.getElementById('current-page');
            notebookPage.setAttribute('data-unit', currentUnit);

            // Controlar clase on-cover para mostrar/ocultar navegaci贸n
            if (currentUnit === 0) {
                document.body.classList.add('on-cover');
            } else {
                document.body.classList.remove('on-cover');
            }

            // Actualizar botones
            updateButtons();

            // Actualizar highlight del men煤
            updateCurrentPageHighlight();

            // Refrescar selector de grupos (bloques de 10)
            refreshGroupSelect();

            // initNotes ya se llama tras inyectar contenido
        }

        // Funci贸n para actualizar botones
        function updateButtons() {
            const unit = unidades[currentUnit];
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const autoBtn = document.getElementById('auto-btn');

            // Verificar que los elementos existan antes de modificarlos
            if (!prevBtn || !nextBtn || !autoBtn) return;

            if (unit && unit.pages) {
                prevBtn.disabled = currentPageIndex === 0;
                nextBtn.disabled = currentPageIndex >= unit.pages.length - 1;
                autoBtn.disabled = false;
            } else {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                autoBtn.disabled = true;
            }
        }

        // Funci贸n para pasar p谩gina (AVANZAR - animaci贸n hacia la derecha)
        function nextPage() {
            const unit = unidades[currentUnit];
            if (unit && currentPageIndex < unit.pages.length - 1) {
                currentPageIndex++;
                flipPage('next');
            }
        }

        // Funci贸n para p谩gina anterior (RETROCEDER - animaci贸n hacia la izquierda)
        function previousPage() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                flipPage('prev');
            }
        }

        // Funci贸n para animar el cambio de p谩gina con direcci贸n
        function flipPage(direction = 'next') {
            const page = document.getElementById('current-page');
            const animClass = direction === 'prev' ? 'page-flipping-prev' : 'page-flipping-next';

            // Limpiar clases anteriores
            page.classList.remove('page-flipping', 'page-flipping-next', 'page-flipping-prev');

            // Aplicar la animaci贸n correspondiente
            page.classList.add(animClass);
            createPaperSound();

            setTimeout(() => {
                loadContent();
                page.classList.remove(animClass);
                // Actualizar navegaci贸n moderna
                if (typeof window.updateModernNavigation === 'function') {
                    window.updateModernNavigation();
                }
            }, 600);
        }

        // Funci贸n para auto-flip
        function autoFlip() {
            if (isAutoFlipping) {
                isAutoFlipping = false;
                document.getElementById('auto-btn').textContent = ' Auto';
                return;
            }

            isAutoFlipping = true;
            document.getElementById('auto-btn').textContent = '革 Parar';

            const autoFlipInterval = setInterval(() => {
                if (!isAutoFlipping) {
                    clearInterval(autoFlipInterval);
                    return;
                }

                const unit = unidades[currentUnit];
                if (unit && currentPageIndex < unit.pages.length - 1) {
                    nextPage();
                } else {
                    isAutoFlipping = false;
                    document.getElementById('auto-btn').textContent = ' Auto';
                    clearInterval(autoFlipInterval);
                }
            }, 3000);
        }

        // Funci贸n para seleccionar unidad
        function selectUnit(unitNumber) {
            console.log('Selecting unit:', unitNumber); // Debug log
            currentUnit = unitNumber;
            currentPageIndex = 0;
            loadContent();
            if (typeof window.updateModernNavigation === 'function') {
                window.updateModernNavigation();
            }
        }

        // Funci贸n para ir a la portada
        function goToHome() {
            currentUnit = 0;
            currentPageIndex = 0;
            loadContent();
            if (typeof window.updateModernNavigation === 'function') {
                window.updateModernNavigation();
            }
        }

        // Funciones del men煤 desplegable
        function toggleNavMenu() {
            const dropdown = document.getElementById('nav-dropdown');
            const overlay = document.getElementById('nav-overlay');

            if (dropdown.style.display === 'none' || dropdown.style.display === '') {
                dropdown.style.display = 'block';
                dropdown.style.opacity = '1';
                dropdown.style.visibility = 'visible';
                overlay.style.display = 'block';
            } else {
                dropdown.style.display = 'none';
                dropdown.style.opacity = '0';
                dropdown.style.visibility = 'hidden';
                overlay.style.display = 'none';
            }
        }

        function goToPage(unitNumber, pageIndex) {
            currentUnit = unitNumber;
            currentPageIndex = pageIndex;
            loadContent();

            // Cerrar el men煤 despu茅s de navegar
            const dropdown = document.getElementById('nav-dropdown');
            const overlay = document.getElementById('nav-overlay');
            dropdown.style.display = 'none';
            overlay.style.display = 'none';

            // Actualizar navegaci贸n moderna
            if (typeof updateModernNavigation === 'function') {
                updateModernNavigation();
            }

            // Crear sonido de papel
            createPaperSound();
        }

        function updateCurrentPageHighlight() {
            // Remover highlight anterior
            document.querySelectorAll('.nav-page-item').forEach(item => {
                item.classList.remove('current');
            });

            // Agregar highlight a la p谩gina actual
            const currentPageItems = document.querySelectorAll('.nav-page-item');
            if (currentUnit > 0 && currentPageItems.length > 0) {
                // Calcular el 铆ndice correcto basado en la unidad y p谩gina
                let totalIndex = 0;
                for (let unit = 1; unit < currentUnit; unit++) {
                    if (unidades[unit] && unidades[unit].pages) {
                        totalIndex += Math.min(unidades[unit].pages.length, 16); // Limitar a las p谩ginas mostradas en el men煤
                    }
                }
                totalIndex += currentPageIndex;

                if (currentPageItems[totalIndex]) {
                    currentPageItems[totalIndex].classList.add('current');
                }
            }
        }

        // Selector de grupos: poblar y manejar cambios
        function refreshGroupSelect() {
            const select = document.getElementById('group-select');
            const container = document.querySelector('.group-select-container');
            if (!select || !container) return;
            const unit = unidades[currentUnit];
            if (!unit || !unit.pages || currentUnit === 0) {
                container.style.display = 'none';
                select.innerHTML = '';
                return;
            }
            const total = unit.pages.length;
            const groups = Math.ceil(total / 10);
            // Siempre mostrar el selector cuando hay una unidad activa,
            // incluso si solo hay un grupo (1N)
            const currentGroup = Math.floor(currentPageIndex / 10);
            // Rellenar opciones
            select.innerHTML = '';
            for (let g = 0; g < groups; g++) {
                const start = g * 10 + 1;
                const end = Math.min((g + 1) * 10, total);
                const opt = document.createElement('option');
                opt.value = String(g);
                opt.textContent = `Grupo ${g + 1} (${start}${end})`;
                if (g === currentGroup) opt.selected = true;
                select.appendChild(opt);
            }
            container.style.display = 'block';
        }

        document.addEventListener('change', function (ev) {
            const select = document.getElementById('group-select');
            if (ev.target === select) {
                const g = parseInt(select.value, 10) || 0;
                const unit = unidades[currentUnit];
                if (!unit || !unit.pages) return;
                const targetIndex = Math.min(g * 10, unit.pages.length - 1);
                currentPageIndex = targetIndex;
                flipPage();
            }
        });

        // Inicializaci贸n de notas locales y exportaci贸n
        function initNotes() {
            const noteContainers = document.querySelectorAll('.notes');
            noteContainers.forEach(container => {
                const key = container.getAttribute('data-note-key');
                if (!key) return;
                const textarea = container.querySelector('textarea');
                const saveBtn = container.querySelector('[data-action="save"]');
                const clearBtn = container.querySelector('[data-action="clear"]');
                const storageKey = 'notebook-note-' + key;

                const saved = localStorage.getItem(storageKey);
                if (saved !== null && textarea) {
                    textarea.value = saved;
                }

                if (saveBtn && textarea) {
                    saveBtn.onclick = () => {
                        localStorage.setItem(storageKey, textarea.value || '');
                        createPaperSound();
                    };
                }

                if (clearBtn && textarea) {
                    clearBtn.onclick = () => {
                        textarea.value = '';
                        localStorage.removeItem(storageKey);
                        createPaperSound();
                    };
                }
            });
        }

        function exportNotes() {
            const prefix = 'notebook-note-';
            const notes = [];
            for (let i = 0; i < localStorage.length; i++) {
                const k = localStorage.key(i);
                if (k && k.startsWith(prefix)) {
                    notes.push({ key: k.substring(prefix.length), value: localStorage.getItem(k) || '' });
                }
            }
            const md = notes.map(n => `## ${n.key}\n\n${n.value}\n`).join('\n');
            const blob = new Blob([md], { type: 'text/markdown' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'apuntes-macroeconomia.md';
            a.click();
            URL.revokeObjectURL(a.href);
        }

        // Cerrar men煤 al hacer clic fuera
        document.addEventListener('click', function (event) {
            const navMenu = document.querySelector('.nav-menu');
            const dropdown = document.getElementById('nav-dropdown');
            const menuBtn = document.querySelector('.nav-menu-btn');

            // Verificar que los elementos existan
            if (!navMenu || !dropdown) return;

            if (!navMenu.contains(event.target)) {
                dropdown.classList.remove('show');
                if (menuBtn) menuBtn.classList.remove('active');
            }
        });

        // Funci贸n para imprimir p谩ginas en formato A5 (2 por hoja A4)
        function printPages() {
            const printContainer = document.getElementById('print-container');
            printContainer.innerHTML = '';

            // Bases de recursos por unidad
            const unitResources = {
                1: { assetsBase: '/assets/unidad1/', docsBase: '/content/unidad1/' },
                2: { assetsBase: '/assets/unidad2/', docsBase: '/content/unidad2/' }
            };

            // Reescritura simple de assets para HTML plano
            function rewriteHtmlStringAssets(html, unitIndex) {
                const resources = unitResources[unitIndex];
                if (!resources || !html) return html;
                let out = html;
                function rewriteAttr(tag, attr) {
                    const re = new RegExp(`(<${tag}[^>]*${attr}=["'])([^"']+)(["'])`, 'gi');
                    out = out.replace(re, (m, p1, val, p3) => {
                        if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                        return `${p1}${resources.assetsBase}${val}${p3}`;
                    });
                }
                rewriteAttr('img', 'src');
                rewriteAttr('source', 'src');
                out = out.replace(/(<a[^>]*href=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|mailto:|tel:|#|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                out = out.replace(/(<iframe[^>]*src=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                return out;
            }

            // Obtener especificaci贸n de archivo externo por unidad/p谩gina
            function computeFileSpec(unitIndex, pageIndex) {
                const n = pageIndex + 1;
                let base = unitIndex === 1 ? 'content/unidad1/' : 'content/unidad2/';
                let file = '';
                if (unitIndex === 1) {
                    if (n <= 10) file = 'group_1-10.html';
                    else if (n <= 20) file = 'group_11-20.html';
                    else if (n <= 30) file = 'group_21-30.html';
                    else if (n <= 40) file = 'group_31-40.html';
                    else file = 'group_41-50.html';
                } else if (unitIndex === 2) {
                    if (n <= 10) file = 'group_1-10.html';
                    else if (n <= 20) file = 'group_11-20.html';
                    else file = 'group_21-25.html';
                }
                return `${base}${file}#page-${n}`;
            }

            // Recopilar todas las p谩ginas resolviendo HTML externo
            const tasks = [];
            let pageCounter = 1;
            for (let unitIndex = 1; unitIndex <= 2; unitIndex++) {
                const unit = unidades[unitIndex];
                if (!unit || !unit.pages || unit.pages.length === 0) continue;
                for (let p = 0; p < unit.pages.length; p++) {
                    const spec = computeFileSpec(unitIndex, p);
                    const [path, fragment] = spec.split('#');
                    tasks.push(
                        fetch(path)
                            .then(r => r.ok ? r.text() : Promise.reject(new Error('No se pudo cargar ' + path)))
                            .then(html => {
                                let fragmentHtml = html;
                                if (fragment) {
                                    const tmp = document.createElement('div');
                                    tmp.innerHTML = html;
                                    const node = tmp.querySelector(`#${fragment}`);
                                    fragmentHtml = node ? node.innerHTML : html;
                                }
                                fragmentHtml = rewriteHtmlStringAssets(fragmentHtml, unitIndex);
                                return {
                                    content: fragmentHtml,
                                    pageNumber: pageCounter++,
                                    unitTitle: unit.title
                                };
                            })
                    );
                }
            }

            Promise.all(tasks).then(allPages => {
                console.log(`Total de p谩ginas a imprimir: ${allPages.length}`);
                if (allPages.length === 0) {
                    alert('No hay p谩ginas para imprimir');
                    return;
                }

                // Generar p谩ginas de impresi贸n (2 p谩ginas A5 por hoja A4)
                for (let i = 0; i < allPages.length; i += 2) {
                    const printSheet = document.createElement('div');
                    printSheet.className = 'print-sheet';

                    const page1 = createPrintPage(allPages[i], allPages[i].pageNumber, allPages[i].unitTitle);
                    printSheet.appendChild(page1);
                    if (i + 1 < allPages.length) {
                        const page2 = createPrintPage(allPages[i + 1], allPages[i + 1].pageNumber, allPages[i + 1].unitTitle);
                        printSheet.appendChild(page2);
                    }
                    printContainer.appendChild(printSheet);
                }

                // Mostrar el contenedor de impresi贸n para que las im谩genes se carguen
                printContainer.style.display = 'block';
                printContainer.style.visibility = 'hidden';
                printContainer.style.position = 'absolute';
                printContainer.style.top = '0';
                printContainer.style.left = '0';
                printContainer.style.zIndex = '1';
                printContainer.style.background = 'white';
                printContainer.style.width = '100%';
                printContainer.style.height = 'auto';

                // Precargar todas las im谩genes
                const images = printContainer.querySelectorAll('img');
                console.log(`Encontradas ${images.length} im谩genes para imprimir`);
                let loadedImages = 0;
                const totalImages = images.length;

                function checkAllImagesLoaded() {
                    loadedImages++;
                    if (loadedImages >= totalImages) {
                        setTimeout(() => {
                            printContainer.style.visibility = 'visible';
                            printContainer.style.display = 'block';
                            document.querySelector('.sidebar').style.display = 'none';
                            document.querySelector('.notebook-container').style.display = 'none';
                            setTimeout(() => { window.print(); }, 500);
                        }, 500);
                    }
                }

                if (totalImages === 0) {
                    setTimeout(() => {
                        printContainer.style.visibility = 'visible';
                        printContainer.style.display = 'block';
                        document.querySelector('.sidebar').style.display = 'none';
                        document.querySelector('.notebook-container').style.display = 'none';
                        setTimeout(() => { window.print(); }, 500);
                    }, 500);
                    return;
                }

                images.forEach((img) => {
                    if (img.complete && img.naturalHeight !== 0) {
                        checkAllImagesLoaded();
                    } else {
                        img.addEventListener('load', checkAllImagesLoaded);
                        img.addEventListener('error', checkAllImagesLoaded);
                        const originalSrc = img.src; img.src = ''; img.src = originalSrc;
                    }
                });

                setTimeout(() => {
                    if (loadedImages < totalImages) {
                        printContainer.style.visibility = 'visible';
                        printContainer.style.display = 'block';
                        document.querySelector('.sidebar').style.display = 'none';
                        document.querySelector('.notebook-container').style.display = 'none';
                        setTimeout(() => { window.print(); }, 500);
                    }
                }, 10000);
            }).catch(err => {
                alert('Error preparando impresi贸n: ' + err.message);
            });
        }

        // Funci贸n para restaurar la vista despu茅s de imprimir
        function restoreView() {
            const printContainer = document.getElementById('print-container');
            printContainer.style.display = 'none';
            printContainer.style.visibility = 'hidden';
            document.querySelector('.sidebar').style.display = 'block';
            document.querySelector('.notebook-container').style.display = 'block';
        }

        // Detectar cuando se cierra el di谩logo de impresi贸n
        window.addEventListener('afterprint', restoreView);

        // Funci贸n auxiliar para crear una p谩gina de impresi贸n
        function createPrintPage(pageData, pageNumber, unitTitle) {
            const printPage = document.createElement('div');
            printPage.className = 'print-page';

            // Mantener el contenido HTML exactamente como aparece en pantalla
            const originalContent = pageData.content;

            printPage.innerHTML = `
                <div class="print-page-header">
                    ${unitTitle} - P谩gina ${pageNumber}
                </div>
                <img src="assets/fie.png" alt="Logo FIE" class="fie-logo" onerror="this.style.display='none'">
                <div class="print-page-content">
                    ${originalContent}
                </div>
                <div class="print-page-number">${pageNumber}</div>
            `;

            return printPage;
        }

        // Inicializar
        const ENABLE_KEYBOARD_NAV = true; // Habilitar flechas en escritorio (laptop/PC)
        document.addEventListener('DOMContentLoaded', function () {
            loadContent();
        });

        // Atajos de teclado (desactivados cuando ENABLE_KEYBOARD_NAV = false)
        document.addEventListener('keydown', function (e) {
            if (!ENABLE_KEYBOARD_NAV) return;
            // Evitar interferir cuando el foco est谩 en campos editables
            const tag = (e.target && e.target.tagName || '').toLowerCase();
            const editable = e.target && (e.target.isContentEditable || tag === 'input' || tag === 'textarea' || tag === 'select');
            if (editable) return;

            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                if (typeof nextPage === 'function') nextPage();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                if (typeof previousPage === 'function') previousPage();
            } else if (e.key === 'a' || e.key === 'A') {
                e.preventDefault();
                if (typeof autoFlip === 'function') autoFlip();
            }
        });
    </script>
    <!-- Bot贸n de alternancia del modo de interacci贸n -->
    <!-- Bot贸n de alternancia ocultado por requerimiento: fijar siempre modo tap -->
    <!-- <button id="interactionToggle" class="interaction-toggle" title="Cambiar modo de interacci贸n">Interacci贸n: Tap/Swipe</button> -->
    <!-- Indicador m贸vil de interacci贸n -->
    <div id="tapHint" aria-live="polite" style="
              position: fixed;
              left: 50%;
              bottom: 16px;
              transform: translateX(-50%);
              background: rgba(0,0,0,0.75);
              color: #fff;
              padding: 8px 12px;
              border-radius: 12px;
              font-size: 14px;
              box-shadow: 0 2px 10px rgba(0,0,0,0.3);
              z-index: 1000;
              display: none;
            ">Toca para avanzar 路 doble toque para retroceder</div>

    <!-- Acciones flotantes para m贸vil -->
    <div class="floating-actions" aria-label="Acciones r谩pidas">
        <button id="faMenu" class="fab" title="Ir a Tema"></button>
        <button id="faPrint" class="fab" title="Imprimir">锔</button>
    </div>

    <!-- Interacciones: tap para avanzar y swipe para navegar -->
    <script>
        (function () {
            const STORAGE_KEY = 'interactionMode';
            const DEFAULT_MODE = 'tap'; // solo click/tap por defecto
            let interactionMode = localStorage.getItem(STORAGE_KEY) || DEFAULT_MODE;
            let singleTapTimer = null;
            const SINGLE_TAP_DELAY = 250;

            function setToggleLabel() {
                const toggle = document.getElementById('interactionToggle');
                if (!toggle) return;
                const label = interactionMode === 'tap' ? 'Interacci贸n: Tap' : interactionMode === 'swipe' ? 'Interacci贸n: Swipe' : 'Interacci贸n: Tap/Swipe';
                toggle.textContent = label;
            }

            function cycleInteractionMode() {
                interactionMode = interactionMode === 'tap_swipe' ? 'tap' : interactionMode === 'tap' ? 'swipe' : 'tap_swipe';
                localStorage.setItem(STORAGE_KEY, interactionMode);
                setToggleLabel();
            }

            function initInteractions() {
                if (window.__interactionsBound) return;
                window.__interactionsBound = true;

                // Prioriza el 谩rea de contenido para evitar capturar clics en la UI lateral
                const pageArea = document.getElementById('page-content') || document.querySelector('.notebook-page') || document.body;
                let startX = 0, startY = 0, isPointerDown = false;

                // Evitar que clics en elementos interactivos disparen navegaci贸n
                function isInteractiveClick(evt) {
                    if (!evt || !evt.target) return false;
                    const interactiveSelectors = 'button, a, .nav-menu-btn, .nav-btn, .fab, .floating-actions, .nav-dropdown, .start-btn, #faMenu, #faPrint';
                    return !!evt.target.closest(interactiveSelectors);
                }

                // Tap/click: single tap = siguiente, double tap = anterior
                pageArea.addEventListener('click', function (e) {
                    // Fix: Skip interactive check on cover to avoid null errors
                    if (document.body.classList.contains('on-cover')) {
                        return;
                    }
                    if (isInteractiveClick(e)) return;
                    if (interactionMode === 'swipe') return; // solo swipe
                    if (singleTapTimer) {
                        clearTimeout(singleTapTimer);
                        singleTapTimer = null;
                        if (typeof previousPage === 'function') previousPage();
                        return;
                    }
                    singleTapTimer = setTimeout(function () {
                        singleTapTimer = null;
                        if (typeof nextPage === 'function') nextPage();
                    }, SINGLE_TAP_DELAY);
                });

                // Swipe/arrastre: navegar
                function getPoint(evt) {
                    if (evt.changedTouches && evt.changedTouches.length) {
                        return { x: evt.changedTouches[0].clientX, y: evt.changedTouches[0].clientY };
                    }
                    if (evt.touches && evt.touches.length) {
                        return { x: evt.touches[0].clientX, y: evt.touches[0].clientY };
                    }
                    return { x: evt.clientX, y: evt.clientY };
                }

                pageArea.addEventListener('pointerdown', function (e) {
                    if (interactionMode === 'tap') return; // solo tap
                    isPointerDown = true;
                    const p = getPoint(e);
                    startX = p.x; startY = p.y;
                });

                pageArea.addEventListener('pointerup', function (e) {
                    if (isInteractiveClick(e)) return;
                    if (interactionMode === 'tap') return; // solo tap
                    if (!isPointerDown) return;
                    isPointerDown = false;
                    const p = getPoint(e);
                    const dx = p.x - startX;
                    const dy = p.y - startY;
                    if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(dy)) {
                        if (dx < 0) {
                            if (typeof nextPage === 'function') nextPage();
                        } else {
                            if (typeof previousPage === 'function') previousPage();
                        }
                    } else if (interactionMode === 'tap_swipe') {
                        // gesto corto: tratar como tap
                        if (typeof nextPage === 'function') nextPage();
                    }
                });

                // Soporte para touchstart/touchend (algunos navegadores m贸viles)
                pageArea.addEventListener('touchstart', function (e) {
                    if (interactionMode === 'tap') return;
                    const p = getPoint(e);
                    isPointerDown = true;
                    startX = p.x; startY = p.y;
                }, { passive: true });

                pageArea.addEventListener('touchend', function (e) {
                    if (isInteractiveClick(e)) return;
                    if (interactionMode === 'tap') return;
                    if (!isPointerDown) return;
                    isPointerDown = false;
                    const p = getPoint(e);
                    const dx = p.x - startX;
                    const dy = p.y - startY;
                    if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(dy)) {
                        if (dx < 0) {
                            if (typeof nextPage === 'function') nextPage();
                        } else {
                            if (typeof previousPage === 'function') previousPage();
                        }
                    } else if (interactionMode === 'tap_swipe') {
                        if (typeof nextPage === 'function') nextPage();
                    }
                }, { passive: true });
            }

            // Indicador m贸vil: muestra una pista de "Toca para avanzar / doble toque para retroceder"
            function showTapHintIfMobile() {
                const hint = document.getElementById('tapHint');
                if (!hint) return;
                const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                const isSmallViewport = window.innerWidth <= 768;
                if (!(isTouchDevice || isSmallViewport)) return;

                // Mostrar la pista
                hint.style.display = 'block';

                // Ocultar tras interacci贸n inicial o tras un tiempo
                const pageArea = document.querySelector('.notebook-page') || document.getElementById('page-content') || document.body;
                const hideOnce = () => {
                    hint.style.display = 'none';
                    pageArea.removeEventListener('click', hideOnce);
                    pageArea.removeEventListener('touchend', hideOnce);
                    pageArea.removeEventListener('pointerup', hideOnce);
                };
                pageArea.addEventListener('click', hideOnce, { once: true });
                pageArea.addEventListener('touchend', hideOnce, { once: true });
                pageArea.addEventListener('pointerup', hideOnce, { once: true });
                setTimeout(hideOnce, 5000);
            }

            document.addEventListener('DOMContentLoaded', function () {
                const toggle = document.getElementById('interactionToggle');
                if (toggle) toggle.addEventListener('click', cycleInteractionMode);
                setToggleLabel();
                initInteractions();
                if (!window.__tapHintShown) { showTapHintIfMobile(); window.__tapHintShown = true; }

                // Acciones flotantes
                const faMenu = document.getElementById('faMenu');
                const faPrint = document.getElementById('faPrint');
                if (faMenu) faMenu.addEventListener('click', function () { if (typeof toggleNavMenu === 'function') toggleNavMenu(); });
                if (faPrint) faPrint.addEventListener('click', function () { window.print(); });
            });

            // Reaplicar interacciones tras cambios de p谩gina
            const originalLoadContent = typeof loadContent === 'function' ? loadContent : null;
            if (originalLoadContent) {
                window.loadContent = function (pageNumber) {
                    originalLoadContent(pageNumber);
                    setToggleLabel();
                    initInteractions();
                }
            }
        })();

        // ========================================
        // NAVEGACIN MODERNA - GESTURES & FAB
        // ========================================

        (function () {
            'use strict';

            // Variables para gestos
            let touchStartX = 0;
            let touchStartY = 0;
            let touchEndX = 0;
            let touchEndY = 0;
            let isSwiping = false;
            const SWIPE_THRESHOLD = 50;
            const SWIPE_VELOCITY_THRESHOLD = 0.3;
            let touchStartTime = 0;

            // Animaci贸n de p谩gina actual
            let currentAnimation = 'flip'; // 'flip' o 'slide'

            // Funci贸n para navegar a la siguiente p谩gina con animaci贸n
            window.nextPageAnimated = function (animationType = 'flip') {
                const unit = unidades[currentUnit];
                if (unit && currentPageIndex < unit.pages.length - 1) {
                    const page = document.getElementById('current-page');
                    // Limpiar clases anteriores
                    page.classList.remove('page-flipping', 'page-flipping-next', 'page-flipping-prev');
                    // Usar la nueva animaci贸n de paso de p谩gina hacia la derecha
                    page.classList.add('page-flipping-next');
                    createPaperSound();

                    setTimeout(() => {
                        currentPageIndex++;
                        loadContent();
                        page.classList.remove('page-flipping-next');
                        updateModernNavigation();
                    }, 600);
                }
            };

            // Funci贸n para navegar a la p谩gina anterior con animaci贸n
            window.previousPageAnimated = function (animationType = 'flip') {
                if (currentPageIndex > 0) {
                    const page = document.getElementById('current-page');
                    // Limpiar clases anteriores
                    page.classList.remove('page-flipping', 'page-flipping-next', 'page-flipping-prev');
                    // Usar la nueva animaci贸n de paso de p谩gina hacia la izquierda
                    page.classList.add('page-flipping-prev');
                    createPaperSound();

                    setTimeout(() => {
                        currentPageIndex--;
                        loadContent();
                        page.classList.remove('page-flipping-prev');
                        updateModernNavigation();
                    }, 600);
                }
            };

            // Toggle FAB Menu
            window.toggleFabMenu = function () {
                const menu = document.getElementById('fab-menu');
                menu.classList.toggle('open');
            };

            // Go Home
            window.goHome = function () {
                currentUnit = 0;
                currentPageIndex = 0;
                loadContent();
                updateModernNavigation();
                toggleFabMenu();
            };

            // Toggle Theme (abrir men煤 de temas)
            window.toggleTheme = function () {
                toggleNavMenu();
                toggleFabMenu();
            };

            // Actualizar navegaci贸n moderna
            function updateModernNavigation() {
                const unit = unidades[currentUnit];
                if (!unit) return;

                const totalPages = unit.pages ? unit.pages.length : 1;
                const currentPage = currentPageIndex + 1;

                // Actualizar texto de progreso
                const progressText = document.getElementById('progress-text');
                if (progressText) {
                    if (currentUnit === 0) {
                        progressText.textContent = 'Portada';
                    } else {
                        progressText.textContent = `${currentPage} / ${totalPages}`;
                    }
                }

                // Actualizar dots (m谩ximo 10 dots visibles)
                const dotsContainer = document.getElementById('progress-dots');
                if (dotsContainer) {
                    dotsContainer.innerHTML = '';

                    if (currentUnit === 0) {
                        // En portada, mostrar un dot activo
                        const dot = document.createElement('div');
                        dot.className = 'progress-dot active';
                        dotsContainer.appendChild(dot);
                    } else {
                        // Calcular qu茅 dots mostrar
                        const maxDots = 10;
                        const groupSize = Math.ceil(totalPages / maxDots);
                        const numDots = Math.min(totalPages, maxDots);
                        const currentDot = Math.floor(currentPageIndex / groupSize);

                        for (let i = 0; i < numDots; i++) {
                            const dot = document.createElement('div');
                            dot.className = 'progress-dot' + (i === currentDot ? ' active' : '');
                            dot.onclick = () => {
                                const targetPage = i * groupSize;
                                if (targetPage < totalPages) {
                                    currentPageIndex = targetPage;
                                    flipPage();
                                    updateModernNavigation();
                                }
                            };
                            dotsContainer.appendChild(dot);
                        }
                    }
                }

                // Actualizar estado de FAB buttons
                const fabPrev = document.getElementById('fab-prev');
                const fabNext = document.getElementById('fab-next');

                if (currentUnit === 0) {
                    // En portada, prev deshabilitado, next habilitado
                    if (fabPrev) fabPrev.disabled = true;
                    if (fabNext) fabNext.disabled = false;
                } else {
                    if (fabPrev) fabPrev.disabled = currentPageIndex === 0;
                    if (fabNext) fabNext.disabled = currentPageIndex >= totalPages - 1;
                }

                // Mostrar navegaci贸n siempre
                const progressContainer = document.getElementById('progress-container');
                const fabMenu = document.getElementById('fab-menu');

                if (progressContainer) progressContainer.style.display = 'flex';
                if (fabPrev) fabPrev.style.display = 'flex';
                if (fabNext) fabNext.style.display = 'flex';
                if (fabMenu) fabMenu.style.display = 'block';
            }

            // Inicializar gestos t谩ctiles
            function initTouchGestures() {
                const notebookContainer = document.querySelector('.notebook-container');
                if (!notebookContainer) return;

                notebookContainer.addEventListener('touchstart', handleTouchStart, { passive: true });
                notebookContainer.addEventListener('touchmove', handleTouchMove, { passive: true });
                notebookContainer.addEventListener('touchend', handleTouchEnd, { passive: true });

                // Tambi茅n para mouse (drag)
                notebookContainer.addEventListener('mousedown', handleMouseDown);
            }

            function handleTouchStart(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                touchStartTime = Date.now();
                isSwiping = true;
            }

            function handleTouchMove(e) {
                if (!isSwiping) return;

                touchEndX = e.touches[0].clientX;
                touchEndY = e.touches[0].clientY;

                const diffX = touchEndX - touchStartX;

                // Mostrar indicadores de swipe
                if (Math.abs(diffX) > 20) {
                    if (diffX > 0 && currentPageIndex > 0) {
                        document.getElementById('swipe-left')?.classList.add('visible');
                    } else if (diffX < 0) {
                        const unit = unidades[currentUnit];
                        if (unit && currentPageIndex < unit.pages.length - 1) {
                            document.getElementById('swipe-right')?.classList.add('visible');
                        }
                    }
                }
            }

            function handleTouchEnd(e) {
                if (!isSwiping) return;
                isSwiping = false;

                // Ocultar indicadores
                document.getElementById('swipe-left')?.classList.remove('visible');
                document.getElementById('swipe-right')?.classList.remove('visible');

                const diffX = touchEndX - touchStartX;
                const diffY = touchEndY - touchStartY;
                const touchDuration = Date.now() - touchStartTime;
                const velocity = Math.abs(diffX) / touchDuration;

                // Solo procesar swipe horizontal
                if (Math.abs(diffX) > SWIPE_THRESHOLD && Math.abs(diffX) > Math.abs(diffY)) {
                    if (velocity > SWIPE_VELOCITY_THRESHOLD || Math.abs(diffX) > 100) {
                        if (diffX < 0) {
                            // Swipe hacia la izquierda = siguiente p谩gina
                            nextPageAnimated('flip');
                        } else {
                            // Swipe hacia la derecha = p谩gina anterior
                            previousPageAnimated('flip');
                        }
                    }
                }

                // Reset
                touchStartX = 0;
                touchStartY = 0;
                touchEndX = 0;
                touchEndY = 0;
            }

            // Mouse drag support
            let isDragging = false;
            let dragStartX = 0;

            function handleMouseDown(e) {
                isDragging = true;
                dragStartX = e.clientX;
                touchStartTime = Date.now();

                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
            }

            function handleMouseMove(e) {
                if (!isDragging) return;

                const diffX = e.clientX - dragStartX;

                if (Math.abs(diffX) > 20) {
                    if (diffX > 0 && currentPageIndex > 0) {
                        document.getElementById('swipe-left')?.classList.add('visible');
                    } else if (diffX < 0) {
                        const unit = unidades[currentUnit];
                        if (unit && currentPageIndex < unit.pages.length - 1) {
                            document.getElementById('swipe-right')?.classList.add('visible');
                        }
                    }
                }
            }

            function handleMouseUp(e) {
                if (!isDragging) return;
                isDragging = false;

                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);

                // Ocultar indicadores
                document.getElementById('swipe-left')?.classList.remove('visible');
                document.getElementById('swipe-right')?.classList.remove('visible');

                const diffX = e.clientX - dragStartX;
                const dragDuration = Date.now() - touchStartTime;
                const velocity = Math.abs(diffX) / dragDuration;

                if (Math.abs(diffX) > SWIPE_THRESHOLD) {
                    if (velocity > SWIPE_VELOCITY_THRESHOLD || Math.abs(diffX) > 100) {
                        if (diffX < 0) {
                            nextPageAnimated('flip');
                        } else {
                            previousPageAnimated('flip');
                        }
                    }
                }

                dragStartX = 0;
            }

            // Navegaci贸n por teclado
            function initKeyboardNavigation() {
                document.addEventListener('keydown', (e) => {
                    // Ignorar si est谩 escribiendo en un input
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

                    switch (e.key) {
                        case 'ArrowRight':
                        case 'PageDown':
                            e.preventDefault();
                            nextPageAnimated('flip');
                            break;
                        case 'ArrowLeft':
                        case 'PageUp':
                            e.preventDefault();
                            previousPageAnimated('flip');
                            break;
                        case 'Home':
                            e.preventDefault();
                            goHome();
                            break;
                        case 'Escape':
                            const fabMenu = document.getElementById('fab-menu');
                            if (fabMenu?.classList.contains('open')) {
                                toggleFabMenu();
                            }
                            break;
                    }
                });

                // Mostrar hint de teclado una vez
                if (!sessionStorage.getItem('keyboardHintShown')) {
                    setTimeout(() => {
                        const hint = document.getElementById('keyboard-hint');
                        if (hint) {
                            hint.classList.add('visible');
                            setTimeout(() => {
                                hint.classList.remove('visible');
                            }, 3000);
                        }
                    }, 2000);
                    sessionStorage.setItem('keyboardHintShown', 'true');
                }
            }

            // Cerrar men煤 FAB al hacer clic fuera
            document.addEventListener('click', (e) => {
                const fabMenu = document.getElementById('fab-menu');
                if (fabMenu && !fabMenu.contains(e.target) && fabMenu.classList.contains('open')) {
                    fabMenu.classList.remove('open');
                }
            });

            // Inicializar al cargar
            document.addEventListener('DOMContentLoaded', () => {
                initTouchGestures();
                initKeyboardNavigation();
                updateModernNavigation();

                // Actualizar navegaci贸n cuando se carga contenido
                const originalLoadContent = window.loadContent;
                if (typeof originalLoadContent === 'function') {
                    window.loadContent = function () {
                        originalLoadContent.apply(this, arguments);
                        setTimeout(updateModernNavigation, 100);
                    };
                }
            });

            // Exponer funci贸n para actualizar desde fuera
            window.updateModernNavigation = updateModernNavigation;
        })();
    </script>
</body>

</html>