<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Cuaderno de Apuntes - Macroeconom√≠a I | Edaly Yamileth Paredes Condori - UNA v3.0</title>
    <link rel="icon" href="/assets/fie.png">
    <link
        href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&family=Caveat:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- MathJax global para renderizar f√≥rmulas en todo el sitio -->
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['\\(','\\)'], ['$', '$']],
          displayMath: [['\\[','\\]'], ['$$','$$']],
          macros: {
            Pr: "\\operatorname{Pr}",
            Var: "\\operatorname{Var}",
            SE: "\\operatorname{SE}",
            MSE: "\\operatorname{MSE}",
            E: "\\mathbb{E}",
            Normal: ["\\mathcal{N}\\left(#1,#2\\right)", 2],
            tStudent: ["\\mathrm{t}_{#1}", 1],
            ChiSq: ["\\chi^2_{#1}", 1],
            FDist: ["\\mathrm{F}_{#1,#2}", 2]
          }
        }
      };
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        body {
            background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);
            font-family: 'Kalam', cursive;
            height: 100vh;
            padding: 0;
            overflow: hidden;
            position: relative;
            margin: 0;
        }

        /* Efectos de fondo */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }

        /* Barra lateral de navegaci√≥n */
        .sidebar {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 20px;
            z-index: 30;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 15px;
            border-radius: 20px;
            border: 2px solid rgba(139, 69, 19, 0.2);
            box-shadow:
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
        }

        .nav-btn {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 15px;
            font-family: 'Kalam', cursive;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            box-shadow:
                0 4px 12px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: rotate(-1deg);
            min-width: 120px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn:hover {
            transform: rotate(0deg) translateY(-3px);
            box-shadow:
                0 8px 20px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .nav-btn:active {
            transform: rotate(0deg) translateY(-1px);
            box-shadow:
                0 4px 10px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: rotate(-1deg);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        /* Men√∫ desplegable de navegaci√≥n */
        .nav-menu {
            position: relative;
            margin-bottom: 10px;
        }

        .nav-menu-btn {
            background: linear-gradient(145deg, #10b981, #059669);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 12px;
            font-family: 'Kalam', cursive;
            font-weight: bold;
            font-size: 13px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
            transform: rotate(-1deg);
            min-width: 140px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-menu-btn:hover {
            transform: rotate(0deg) translateY(-2px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }

        .nav-menu-btn .arrow {
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .nav-menu-btn.active .arrow {
            transform: rotate(180deg);
        }

        .nav-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            border: 2px solid rgba(16, 185, 129, 0.2);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .nav-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .nav-unit {
            border-bottom: 1px solid rgba(16, 185, 129, 0.1);
        }

        .nav-unit:last-child {
            border-bottom: none;
        }

        .nav-unit-title {
            background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
            padding: 8px 12px;
            font-family: 'Caveat', cursive;
            font-size: 14px;
            font-weight: 600;
            color: #0c4a6e;
            border-bottom: 1px solid rgba(16, 185, 129, 0.1);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .nav-unit-title:hover {
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
        }

        .nav-pages {
            padding: 5px 0;
        }

        .nav-page-item {
            padding: 6px 15px;
            font-family: 'Kalam', cursive;
            font-size: 11px;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-page-item:hover {
            background: rgba(16, 185, 129, 0.1);
            border-left-color: #10b981;
            color: #065f46;
        }

        .nav-page-item.current {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #3b82f6;
            color: #1e40af;
            font-weight: 600;
        }

        /* Grupos de semanas en navegaci√≥n */
        .nav-week-group {
            margin-bottom: 15px;
            border-left: 3px solid rgba(255, 255, 255, 0.3);
            padding-left: 10px;
        }

        .nav-week-title {
            font-family: 'Caveat', cursive;
            font-size: 16px;
            font-weight: bold;
            color: #fbbf24;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-week-group .nav-page-item {
            margin-left: 10px;
            font-size: 13px;
            padding: 6px 10px;
        }

        /* Scrollbar personalizado para el dropdown */
        .nav-dropdown::-webkit-scrollbar {
            width: 6px;
        }

        .nav-dropdown::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .nav-dropdown::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.5);
            border-radius: 3px;
        }

        .nav-dropdown::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 185, 129, 0.7);
        }

        /* Cuaderno */
        .notebook-container {
            max-width: calc(100vw - 160px);
            width: calc(100vw - 160px);
            height: calc(100vh - 20px);
            margin: 10px auto 10px 150px;
            position: relative;
            transform: translateY(0);
            animation: float 8s ease-in-out infinite;
            z-index: 10;
            overflow: hidden;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
        }

        .notebook {
            background: linear-gradient(145deg, #2C1810, #1a0f08);
            border-radius: 15px;
            padding: 20px;
            box-shadow:
                0 20px 40px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            width: 100%;
            height: 100%;
            border: 3px solid #3d2817;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* Espiral mejorada */
        .spiral-binding {
            position: absolute;
            left: 40px;
            top: 25px;
            bottom: 25px;
            width: 30px;
            background:
                repeating-linear-gradient(to bottom,
                    #666 0px,
                    #666 8px,
                    #888 8px,
                    #888 12px,
                    transparent 12px,
                    transparent 25px);
            border-radius: 12px;
            z-index: 10;
            box-shadow:
                inset 0 0 10px rgba(0, 0, 0, 0.5),
                0 2px 5px rgba(0, 0, 0, 0.3);
        }

        /* P√°gina con efecto flipbook mejorado */
        .notebook-page {
            width: calc(100% - 30px);
            height: calc(100% - 30px);
            background:
                linear-gradient(90deg,
                    transparent 0px,
                    transparent 119px,
                    #ff6b6b 119px,
                    #ff6b6b 121px,
                    transparent 121px),
                repeating-linear-gradient(transparent,
                    transparent 29px,
                    #e3f2fd 29px,
                    #e3f2fd 31px);
            background-color: #fefefe;
            margin-left: 30px;
            border-radius: 8px;
            position: relative;
            box-shadow:
                0 5px 15px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            overflow: visible;
            transform-origin: left center;
            transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            transform-style: preserve-3d;
        }

        /* P√°ginas adicionales para efecto flipbook */
        .notebook-page::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: -5px;
            bottom: -5px;
            background:
                linear-gradient(90deg,
                    transparent 0px,
                    transparent 119px,
                    #ff6b6b 119px,
                    #ff6b6b 121px,
                    transparent 121px),
                repeating-linear-gradient(transparent,
                    transparent 29px,
                    #e3f2fd 29px,
                    #e3f2fd 31px);
            background-color: #f8f8f8;
            border-radius: 8px;
            z-index: -1;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }

        .notebook-page::after {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: -10px;
            bottom: -10px;
            background:
                linear-gradient(90deg,
                    transparent 0px,
                    transparent 119px,
                    #ff6b6b 119px,
                    #ff6b6b 121px,
                    transparent 121px),
                repeating-linear-gradient(transparent,
                    transparent 29px,
                    #e3f2fd 29px,
                    #e3f2fd 31px);
            background-color: #f0f0f0;
            border-radius: 8px;
            z-index: -2;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Animaci√≥n flipbook mejorada */
        .page-flipping {
            animation: flipbookTurn 1.2s ease-in-out forwards;
        }

        @keyframes flipbookTurn {
            0% {
                transform: rotateY(0deg) scale(1);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }

            25% {
                transform: rotateY(45deg) scale(1.02);
                box-shadow: 10px 10px 25px rgba(0, 0, 0, 0.3);
            }

            50% {
                transform: rotateY(90deg) scale(1.05);
                box-shadow: 20px 15px 35px rgba(0, 0, 0, 0.4);
            }

            75% {
                transform: rotateY(135deg) scale(1.02);
                box-shadow: 10px 10px 25px rgba(0, 0, 0, 0.3);
            }

            100% {
                transform: rotateY(180deg) scale(1);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }
        }

        .page-content {
            padding: 40px 50px 60px 160px;
            height: calc(100% - 20px);
            position: relative;
            z-index: 5;
            line-height: 28px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            box-sizing: border-box;
        }

        /* Logo de la FIE en la esquina superior derecha */
        .fie-logo {
            position: absolute;
            top: 10px;
            right: 15px;
            width: 70px;
            height: auto;
            z-index: 10;
            opacity: 0.8;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .fie-logo:hover {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Ocultar logo FIE cuando se muestra la portada */
        .notebook-page[data-unit="0"] .fie-logo {
            display: none !important;
        }

        /* Estilos de escritura mejorados */
        .handwritten-title {
            font-family: 'Caveat', cursive;
            font-size: 28px;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 15px;
            transform: rotate(-0.5deg);
            text-shadow:
                1px 1px 2px rgba(0, 0, 0, 0.1),
                0 0 10px rgba(30, 64, 175, 0.2);
            position: relative;
        }

        .handwritten-text {
            font-family: 'Kalam', cursive;
            font-size: 14px;
            color: #2d3748;
            margin-bottom: 10px;
            transform: rotate(0.1deg);
            line-height: 28px;
            position: relative;
        }

        .handwritten-formula {
            background:
                linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.2));
            border: 3px dashed #3b82f6;
            border-radius: 15px;
            padding: 12px;
            margin: 15px 0;
            font-family: 'Caveat', cursive;
            font-size: 18px;
            font-weight: 600;
            color: #1e40af;
            text-align: center;
            transform: rotate(-0.3deg);
            position: relative;
            box-shadow:
                0 2px 8px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .hi ghlighted-note {
            background: linear-gradient(120deg, #fef3c7 0%, #fde68a 100%);
            border-left: 5px solid #f59e0b;
            padding: 10px;
            margin: 12px 0;
            font-family: 'Kalam', cursive;
            font-size: 13px;
            color: #92400e;
            font-style: italic;
            transform: rotate(-0.2deg);
            border-radius: 0 8px 8px 0;
            position: relative;
            box-shadow:
                0 2px 8px rgba(245, 158, 11, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        /* Tablas estilo cuaderno */
        .handwritten-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            font-family: 'Kalam', cursive;
            font-size: 12px;
            transform: rotate(-0.1deg);
        }

        .handwritten-table th {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            padding: 8px;
            text-align: left;
            font-weight: bold;
            border: 2px solid #1e40af;
        }

        .handwritten-table td {
            padding: 6px 8px;
            border: 1px solid #94a3b8;
            background: rgba(255, 255, 255, 0.7);
        }

        .handwritten-table tr:nth-child(even) td {
            background: rgba(241, 245, 249, 0.8);
        }

        /* Cajas de informaci√≥n */
        .info-box {
            background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
            border: 2px solid #0288d1;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            transform: rotate(0.2deg);
            box-shadow: 0 4px 12px rgba(2, 136, 209, 0.2);
        }

        .warning-box {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 2px solid #f57c00;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            transform: rotate(-0.3deg);
            box-shadow: 0 4px 12px rgba(245, 124, 0, 0.2);
        }

        .success-box {
            background: linear-gradient(135deg, #e8f5e8, #c8e6c9);
            border: 2px solid #388e3c;
            border-radius: 12px;
            padding: 12px;
            margin: 15px 0;
            transform: rotate(0.1deg);
            box-shadow: 0 4px 12px rgba(56, 142, 60, 0.2);
        }

        /* F√≥rmulas destacadas */
        .formula-box {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            border: 3px dashed #8e24aa;
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Caveat', cursive;
            font-size: 20px;
            font-weight: 600;
            color: #4a148c;
            text-align: center;
            transform: rotate(-0.2deg);
            box-shadow: 0 4px 12px rgba(142, 36, 170, 0.2);
        }

        /* Definiciones */
        .definition-box {
            background: linear-gradient(135deg, #fce4ec, #f8bbd9);
            border-left: 6px solid #e91e63;
            padding: 12px;
            margin: 15px 0;
            font-style: italic;
            border-radius: 0 10px 10px 0;
            transform: rotate(0.1deg);
        }

        /* Ejemplos pr√°cticos */
        .example-box {
            background: linear-gradient(135deg, #f1f8e9, #dcedc8);
            border: 2px dotted #689f38;
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            transform: rotate(-0.1deg);
        }

        /* Sticky Note para informaci√≥n clave */
        .sticky-note {
            position: absolute;
            top: 80px;
            right: 20px;
            width: 220px;
            background: linear-gradient(135deg, #fff9c4, #fff59d);
            border: 1px solid #f57f17;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(245, 127, 23, 0.2);
            transform: rotate(2deg);
            z-index: 5;
            font-family: 'Caveat', cursive;
            font-size: 14px;
        }

        .sticky-note::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 15px;
            background: rgba(255, 193, 7, 0.6);
            border-radius: 0 0 8px 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .sticky-note-title {
            font-weight: bold;
            color: #e65100;
            margin-bottom: 8px;
            text-align: center;
            font-size: 16px;
        }

        .sticky-note-content {
            color: #5d4037;
            line-height: 1.4;
            text-align: center;
        }



        /* Gr√°ficos placeholder mejorados */
        .graph-placeholder {
            border: 3px dashed #666;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            background: linear-gradient(135deg, #f9f9f9, #f0f0f0);
            border-radius: 12px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transform: rotate(0.1deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .graph-title {
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .graph-description {
            font-size: 12px;
            color: #718096;
            font-style: italic;
        }

        /* Contenedor para im√°genes reales */
        .graph-container {
            margin: 20px 0;
            text-align: center;
            background: linear-gradient(135deg, #f9f9f9, #f0f0f0);
            border-radius: 12px;
            padding: 15px;
            transform: rotate(0.1deg);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .graph-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin: 10px 0;
            border: 2px solid #e2e8f0;
            background: white;
            padding: 5px;
        }

        .graph-container .graph-title {
            font-weight: bold;
            font-size: 16px;
            color: #2d3748;
            margin-bottom: 10px;
            font-family: 'Caveat', cursive;
        }

        .graph-container .graph-description {
            font-size: 12px;
            color: #718096;
            font-style: italic;
            margin-top: 8px;
            font-family: 'Kalam', cursive;
        }

        /* Layout de dos columnas para contenido con im√°genes */
        .two-column-layout {
            display: flex;
            gap: 20px;
            margin: 15px 0;
            align-items: flex-start;
        }

        .column-left {
            flex: 1;
            min-width: 0;
        }

        .column-right {
            flex: 1;
            min-width: 0;
        }

        .column-image {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid #e2e8f0;
            background: white;
            padding: 5px;
        }

        .image-caption {
            font-size: 11px;
            color: #718096;
            font-style: italic;
            text-align: center;
            margin-top: 5px;
            font-family: 'Kalam', cursive;
        }

        /* Fallback visual cuando <img> no renderiza: usa background-image */
        .image-fallback {
            width: 100%;
            max-width: 100%;
            min-height: 220px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid #e2e8f0;
            background-color: #fff;
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
        }

        /* Responsive: en pantallas peque√±as, volver a columna √∫nica */
        @media (max-width: 768px) {
            .two-column-layout {
                flex-direction: column;
            }
        }

        .page-number {
            position: absolute;
            bottom: 20px;
            right: 30px;
            font-family: 'Caveat', cursive;
            font-size: 18px;
            color: #6b7280;
            transform: rotate(-2deg);
            border: 2px solid #6b7280;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        /* Portada estilo cuaderno real - OPTIMIZADA PARA ALTURA */
        .cover-page {
            position: relative;
            padding: 12px 16px;
            height: 100%;
            width: 100%;
            background: linear-gradient(135deg, #2a5298 0%, #1e3a8a 50%, #1e40af 100%);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 10px;
        }

        /* Espacios para logos en la parte superior */
        .logo-spaces {
            position: absolute;
            top: 12px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 15;
        }

        .logo-space {
            width: clamp(72px, 10vw, 96px);
            height: clamp(72px, 10vw, 96px);
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            border: 2px solid #e2e8f0;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow:
                0 6px 15px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transform: rotate(-2deg);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            padding: 10px;
        }

        .logo-space:nth-child(2) {
            transform: rotate(2deg);
        }

        .logo-space img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        /* Fallback cuando las im√°genes no cargan */
        .logo-space::before {
            content: 'üèõÔ∏è';
            font-size: 40px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        .logo-space:nth-child(2)::before {
            content: 'üéì';
        }

        .logo-space img:not([src=""]) {
            z-index: 2;
            position: relative;
        }

        .logo-space:hover {
            transform: rotate(0deg) scale(1.05);
            border-color: #3b82f6;
            box-shadow:
                0 6px 20px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
        }

        .logo-space::after {
            content: '';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Kalam', cursive;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Textura de cuaderno */
        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                repeating-linear-gradient(45deg,
                    transparent,
                    transparent 2px,
                    rgba(255, 255, 255, 0.03) 2px,
                    rgba(255, 255, 255, 0.03) 4px),
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            z-index: 1;
        }

        /* Etiqueta principal del cuaderno - ULTRA COMPACTA */
        .notebook-label {
            background: linear-gradient(145deg, #fef3c7, #fde68a);
            border: 3px solid #d97706;
            border-radius: 12px;
            padding: 10px 16px;
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            z-index: 10;
            transform: rotate(-1deg);
            margin: 22px auto 0 auto;
            width: min(700px, calc(100% - 48px));
        }

        .cover-title {
            font-family: 'Caveat', cursive;
            font-size: clamp(18px, 2.2vw, 24px);
            font-weight: 700;
            color: #92400e;
            margin: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .cover-subtitle {
            font-family: 'Kalam', cursive;
            font-size: clamp(11px, 1.6vw, 16px);
            color: #b45309;
            margin: 2px 0 0 0;
            text-align: center;
            font-weight: 600;
            line-height: 1.1;
        }

        /* Informaci√≥n del estudiante - SUPER COMPACTA */
        .student-info {
            background: linear-gradient(145deg, #ffffff, #f8fafc);
            border: 2px solid #64748b;
            border-radius: 10px;
            padding: 14px 20px;
            box-shadow:
                0 6px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            z-index: 10;
            width: clamp(340px, 62vw, 560px);
            max-width: calc(100% - 48px);
            transform: rotate(1deg);
            position: relative;
        }

        .student-info::before {
            content: 'üìù';
            position: absolute;
            top: -12px;
            left: -12px;
            font-size: 20px;
            background: #3b82f6;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .info-line {
            font-family: 'Kalam', cursive;
            font-size: clamp(12px, 1.8vw, 16px);
            color: #1e293b;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px dotted #cbd5e1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            line-height: 1.35;
        }

        .info-line:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .info-label {
            font-weight: 600;
            color: #475569;
            min-width: clamp(90px, 40%, 160px);
        }

        .info-value {
            color: #1e40af;
            font-weight: 600;
            text-align: right;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Decoraciones del cuaderno - REPOSICIONADAS */
        .notebook-decoration {
            position: absolute;
            z-index: 2;
        }

        .decoration-1 {
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #ef4444, #dc2626);
            border-radius: 50%;
            transform: rotate(-15deg);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .decoration-1::after {
            content: 'üìö';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }

        .decoration-2 {
            bottom: 20px;
            left: 25px;
            width: 60px;
            height: 30px;
            background: linear-gradient(45deg, #10b981, #059669);
            border-radius: 15px;
            transform: rotate(10deg);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .decoration-2::after {
            content: 'üí°';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
        }

        /* Esquinas del cuaderno - M√ÅS PEQUE√ëAS */
        .corner-decoration {
            position: absolute;
            width: 20px;
            height: 20px;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            z-index: 2;
        }

        .corner-top-left {
            top: 0;
            left: 0;
            clip-path: polygon(0 0, 100% 0, 0 100%);
        }

        .corner-top-right {
            top: 0;
            right: 0;
            clip-path: polygon(100% 0, 100% 100%, 0 0);
        }

        .corner-bottom-left {
            bottom: 0;
            left: 0;
            clip-path: polygon(0 0, 100% 100%, 0 100%);
        }

        .corner-bottom-right {
            bottom: 0;
            right: 0;
            clip-path: polygon(100% 0, 100% 100%, 0 100%);
        }

        /* Botones de navegaci√≥n - COMPACTOS */
        .start-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            z-index: 10;
            width: min(700px, calc(100% - 48px));
            margin: 6px auto 0 auto;
        }

        .start-btn {
            background: linear-gradient(145deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            font-family: 'Caveat', cursive;
            font-size: clamp(14px, 1.8vw, 18px);
            font-weight: 600;
            cursor: pointer;
            box-shadow:
                0 4px 12px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: rotate(-2deg);
            position: relative;
            overflow: hidden;
            min-width: 110px;
        }

        .start-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .start-btn:hover::before {
            left: 100%;
        }

        .start-btn:hover {
            transform: rotate(0deg) translateY(-3px);
            box-shadow:
                0 12px 25px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .start-btn:nth-child(2) {
            transform: rotate(2deg);
            background: linear-gradient(145deg, #8b5cf6, #7c3aed);
            box-shadow:
                0 8px 20px rgba(139, 92, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .start-btn:nth-child(3) {
            transform: rotate(-1deg);
            background: linear-gradient(145deg, #10b981, #059669);
            box-shadow:
                0 8px 20px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                bottom: 20px;
                left: 50%;
                top: auto;
                transform: translateX(-50%);
                flex-direction: row;
                padding: 15px 20px;
                gap: 15px;
                width: calc(100vw - 40px);
                max-width: 600px;
                flex-wrap: wrap;
            }

            .nav-btn {
                flex: 1;
                min-width: 80px;
                padding: 12px 15px;
                font-size: 12px;
            }

            .notebook-container {
                transform: rotate(0deg);
                margin-left: auto;
                margin-bottom: 120px;
                width: calc(100vw - 40px);
                max-width: none;
            }

            .page-content {
                padding: 30px 30px 30px 120px;
                line-height: 26px;
            }

            /* Ajustes adicionales en m√≥viles */
            .logo-spaces { padding: 0 14px; top: 10px; }
            .notebook-label { width: calc(100% - 40px); margin-top: 18px; }
            .student-info { width: calc(100% - 40px); transform: rotate(0.5deg); }
            .start-buttons { width: calc(100% - 40px); gap: 10px; }
        }

        /* Estilos de impresi√≥n - Cuaderno real A5 */
        @media print {
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            @page {
                size: A4 portrait;
                margin: 8mm;
            }

            @media print {
                html, body {
                    width: 210mm;
                    height: 297mm;
                }
            }

            body {
                background: white !important;
                overflow: visible !important;
                height: auto !important;
                margin: 0 !important;
                padding: 0 !important;
                font-family: 'Kalam', cursive;
            }

            .sidebar,
            .notebook-container,
            .notebook,
            .spiral-binding {
                display: none !important;
            }

            .print-container {
                display: block !important;
                width: 100% !important;
                height: 100% !important;
            }

            .print-page {
                width: 100%;
                height: 48vh;
                border: 2px solid #333;
                margin-bottom: 4mm;
                padding: 0;
                box-sizing: border-box;
                background:
                    linear-gradient(90deg, transparent 0px, transparent 25px, #ff6b6b 25px, #ff6b6b 27px, transparent 27px),
                    repeating-linear-gradient(transparent, transparent 18px, #e3f2fd 18px, #e3f2fd 20px);
                background-color: #fefefe;
                position: relative;
                page-break-inside: avoid;
            }

            .print-page:last-child {
                margin-bottom: 0;
            }

            .print-page-header {
                background: linear-gradient(145deg, #fef3c7, #fde68a);
                border-bottom: 2px solid #d97706;
                padding: 8px 15px;
                margin: 0;
                font-family: 'Caveat', cursive;
                font-size: 14px;
                font-weight: bold;
                color: #92400e;
                text-align: center;
            }

            .print-page-content {
                padding: 15px 15px 15px 35px;
                height: calc(100% - 50px);
                overflow: visible;
                font-size: 11px;
                line-height: 20px;
                color: #2d3748;
            }

            /* Estilos para im√°genes en impresi√≥n */
            .two-column-layout {
                display: flex !important;
                gap: 15px !important;
                margin: 10px 0 !important;
                page-break-inside: avoid;
            }

            .column-left,
            .column-right {
                flex: 1 !important;
            }

            .column-image {
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                page-break-inside: avoid;
                display: block !important;
            }

            .image-caption {
                font-size: 9px !important;
                text-align: center !important;
                margin-top: 3px !important;
                color: #666 !important;
            }

            .graph-container {
                margin: 10px 0 !important;
                text-align: center !important;
                page-break-inside: avoid;
            }

            .graph-container img {
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                display: block !important;
            }

            /* Forzar visualizaci√≥n de todas las im√°genes */
            img {
                display: block !important;
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                margin: 5px auto !important;
                page-break-inside: avoid !important;
                visibility: visible !important;
                opacity: 1 !important;
            }

            /* Asegurar que las im√°genes dentro de contenedores tambi√©n aparezcan */
            .print-page img,
            .print-page-content img,
            .two-column-layout img,
            .column-left img,
            .column-right img,
            .column-image,
            .graph-container img {
                display: block !important;
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                margin: 5px auto !important;
                page-break-inside: avoid !important;
                visibility: visible !important;
                opacity: 1 !important;
                background: white !important;
            }

            .print-page-number {
                position: absolute;
                bottom: 8px;
                right: 15px;
                font-size: 10px;
                color: #666;
                border: 1px solid #666;
                border-radius: 50%;
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
                background: rgba(255, 255, 255, 0.8);
            }

            /* Estilos espec√≠ficos para elementos del cuaderno */
            .print-page .handwritten-title {
                font-family: 'Caveat', cursive !important;
                font-size: 16px !important;
                font-weight: bold !important;
                color: #1e40af !important;
                margin: 15px 0 10px 0 !important;
                text-decoration: underline;
            }

            .print-page .formula-box {
                border: 2px dashed #8e24aa !important;
                background: linear-gradient(135deg, #f3e5f5, #e1bee7) !important;
                padding: 10px !important;
                margin: 12px 0 !important;
                text-align: center !important;
                font-family: 'Caveat', cursive !important;
                font-size: 14px !important;
                font-weight: bold !important;
                color: #4a148c !important;
                border-radius: 8px;
            }

            .print-page .handwritten-text {
                margin: 8px 0 !important;
                line-height: 20px !important;
                font-size: 11px !important;
            }

            .print-page .handwritten-table {
                width: 100% !important;
                border-collapse: collapse !important;
                margin: 10px 0 !important;
                font-size: 10px !important;
            }

            .print-page .handwritten-table th {
                background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
                color: white !important;
                padding: 6px !important;
                border: 1px solid #1e40af !important;
                font-weight: bold !important;
            }

            .print-page .handwritten-table td {
                padding: 5px !important;
                border: 1px solid #94a3b8 !important;
                background: rgba(255, 255, 255, 0.7) !important;
            }

            .print-page .info-box,
            .print-page .warning-box,
            .print-page .success-box,
            .print-page .example-box,
            .print-page .definition-box {
                border: 2px solid #0288d1 !important;
                background: linear-gradient(135deg, #e0f2fe, #b3e5fc) !important;
                padding: 8px !important;
                margin: 10px 0 !important;
                border-radius: 8px !important;
                font-size: 10px !important;
            }

            .print-page .highlighted-note {
                background: linear-gradient(120deg, #fef3c7, #fde68a) !important;
                border-left: 4px solid #f59e0b !important;
                padding: 8px !important;
                margin: 10px 0 !important;
                font-style: italic !important;
            }



            /* Re-aplicar estilos espec√≠ficos despu√©s del revert */
            .print-page img {
                display: block !important;
                max-width: 100% !important;
                height: auto !important;
                border: 1px solid #333 !important;
                border-radius: 4px !important;
                margin: 5px auto !important;
                page-break-inside: avoid !important;
            }

            .print-page .two-column-layout {
                display: flex !important;
                gap: 15px !important;
                margin: 10px 0 !important;
                page-break-inside: avoid !important;
            }

            .print-page .column-left,
            .print-page .column-right {
                flex: 1 !important;
            }

            /* Logo FIE en impresi√≥n */
            .print-page .fie-logo {
                position: absolute !important;
                top: 8px !important;
                right: 12px !important;
                width: 35px !important;
                height: auto !important;
                z-index: 15 !important;
                opacity: 0.7 !important;
                border-radius: 4px !important;
            }
        }

        .print-container {
            display: none;
        }
    </style>
    <!-- Optimizaci√≥n de espacios e interacci√≥n: estilos adicionales -->
    <style>
        .interaction-toggle {
            position: fixed;
            right: 24px;
            bottom: 24px;
            padding: 10px 14px;
            border-radius: 12px;
            border: none;
            background: #4e7cff;
            color: #fff;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            cursor: pointer;
            z-index: 1000;
            font-weight: 600;
        }
        .interaction-toggle:hover { filter: brightness(1.05); }

        .floating-actions {
            position: fixed;
            left: 16px;
            bottom: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        .fab {
            width: 44px; height: 44px;
            border-radius: 50%;
            border: none;
            background: #00b894;
            color: #fff;
            font-size: 20px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
            cursor: pointer;
        }
        .fab:hover { filter: brightness(1.06); }

        /* Ocultar barra lateral en pantallas peque√±as y usar acciones flotantes */
        @media (max-width: 768px) {
            .sidebar, .side-menu, .nav-sidebar { display: none !important; }
            .floating-actions { display: flex; }
        }
        @media (min-width: 769px) {
            .floating-actions { display: none; }
        }
    </style>
</head>
<body>
    <!-- Barra lateral de navegaci√≥n -->
    <div class="sidebar">
        <!-- Men√∫ desplegable de navegaci√≥n -->
        <div class="nav-menu">
            <button class="nav-menu-btn" onclick="toggleNavMenu()">
                üìö Ir a Tema <span class="arrow">‚ñº</span>
            </button>
            <div class="nav-dropdown" id="nav-dropdown">
                <div class="nav-unit">
                    <div class="nav-unit-title" onclick="selectUnit(1)">üìñ Unidad I - Macroeconom√≠a I</div>
                    <div class="nav-pages">
                        <div class="nav-page-item" onclick="goToPage(1, 0)">üìä Semana 1: El Mercado de Bienes</div>
                        <div class="nav-page-item" onclick="goToPage(1, 24)">üí∞ Semana 2: Mercado de Dinero</div>
                        <div class="nav-page-item" onclick="goToPage(1, 54)">‚öñÔ∏è Semana 3: Modelo IS-LM</div>
                        <div class="nav-page-item" onclick="goToPage(1, 68)">üåç Semana 4: Modelo Mundell-Fleming - Econom√≠a Abierta</div>
                        <div class="nav-page-item" onclick="goToPage(1, 73)">üåä Semana 5: Pol√≠ticas con Tipo de Cambio Flexible</div>
                        <div class="nav-page-item" onclick="goToPage(1, 76)">üîÆ Semana 6: Expectativas en Macroeconom√≠a</div>
                        <div class="nav-page-item" onclick="goToPage(1, 79)">üìà Semana 7: Introducci√≥n al Crecimiento Econ√≥mico</div>
                        <div class="nav-page-item" onclick="goToPage(1, 84)">üí∞ Semana 8: El Mercado de Dinero</div>
                        <div class="nav-page-item" onclick="goToPage(1, 86)">üåä Semana 9: Ciclos Econ√≥micos y Fluctuaciones</div>
                    </div>
                </div>
                <div class="nav-unit">
                    <div class="nav-unit-title" onclick="selectUnit(2)">üìä Unidad II - El Modelo OA-DA</div>
                    <div class="nav-pages">
                        <div class="nav-page-item" onclick="goToPage(2, 0)">üìà Semana 10: La Curva de Demanda Agregada</div>
                        <div class="nav-page-item" onclick="goToPage(2, 1)">üë∑ Semana 11: El Mercado de Trabajo</div>
                        <div class="nav-page-item" onclick="goToPage(2, 2)">üìà Semana 12: La Curva de Oferta Agregada</div>
                        <div class="nav-page-item" onclick="goToPage(2, 3)">‚öñÔ∏è Semana 13: El Modelo OA-DA</div>
                        <div class="nav-page-item" onclick="goToPage(2, 4)">üèõÔ∏è Semana 14: Pol√≠ticas Fiscales y Monetarias</div>
                        <div class="nav-page-item" onclick="goToPage(2, 5)">üîÆ Semana 15: Expectativas y Oferta Agregada</div>
                        <div class="nav-page-item" onclick="goToPage(2, 6)">üìà Semana 16: La Curva de Phillips</div>
                        <div class="nav-page-item" onclick="goToPage(2, 7)">üí∞ Semana 17: D√©ficit Fiscal y Financiamiento</div>
                    </div>
                </div>
            </div>
        </div>

        <button class="nav-btn" id="home-btn" onclick="goToHome()">
            üè† Portada
        </button>
        <button class="nav-btn" id="prev-btn" onclick="previousPage()" disabled>
            ‚Üê Anterior
        </button>
        <button class="nav-btn" id="next-btn" onclick="nextPage()" disabled>
            Siguiente ‚Üí
        </button>
        <button class="nav-btn" id="auto-btn" onclick="autoFlip()" disabled>
            üîÑ Auto
        </button>
        <button class="nav-btn" id="print-btn" onclick="printPages()">
            üñ®Ô∏è Imprimir
        </button>
        <!-- Selector de grupos (bloques de 10 p√°ginas) -->
        <div class="group-select-container" style="margin-top:8px; display:none;">
            <label for="group-select" class="nav-label" style="display:block; font-weight:600; color:#1f2937; margin-bottom:6px;">Agrupar: 10 p√°gs</label>
            <select id="group-select" class="nav-select" style="width:100%; padding:8px 10px; border:2px solid #cbd5e1; border-radius:10px; background:#fff; color:#1f2937; font-weight:600; cursor:pointer;">
            </select>
        </div>
    </div>

    <!-- Cuaderno -->
    <div class="notebook-container">
        <div class="notebook">
            <!-- Espiral -->
            <div class="spiral-binding"></div>

            <!-- P√°gina actual -->
            <div class="notebook-page" id="current-page">
                <!-- Logo de la FIE -->
                <img src="assets/fie.png" alt="Logo FIE" class="fie-logo" onerror="this.style.display='none'">
                
                <div class="page-content" id="page-content">
                    <!-- Contenido se carga din√°micamente -->
                </div>
                <div class="page-number" id="page-number">0</div>
            </div>
        </div>
    </div>

    <!-- Contenedor para impresi√≥n (oculto en pantalla) -->
    <div class="print-container" id="print-container">
        <!-- Se genera din√°micamente -->
    </div>

    <script>
        // Variables globales
        let currentPageIndex = 0;
        let currentUnit = 0;
        let pages = [];
        let isAutoFlipping = false;

        // Funci√≥n para crear sonido de papel
        function createPaperSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();

                const osc = audioContext.createOscillator();
                const gain = audioContext.createGain();

                osc.connect(gain);
                gain.connect(audioContext.destination);

                osc.type = 'sine';
                osc.frequency.setValueAtTime(300, audioContext.currentTime);
                osc.frequency.exponentialRampToValueAtTime(150, audioContext.currentTime + 0.08);

                gain.gain.setValueAtTime(0.003, audioContext.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.08);

                osc.start();
                osc.stop(audioContext.currentTime + 0.08);

            } catch (e) {
                console.log('Web Audio no disponible');
            }
        }
        // Contenido de las p√°ginas
        const unidades = {
            0: { // Portada
                title: "Portada",
                pages: [
                    {
                        content: `
                            <div class="cover-page">
                                <!-- Espacios para logos -->
                                <div class="logo-spaces">
                                    <div class="logo-space" title="Universidad Nacional">
                                        <img src="assets/una.png" alt="Logo Universidad Nacional" onerror="this.style.display='none'" />
                                    </div>
                                    <div class="logo-space" title="Facultad de Ingenier√≠a Econ√≥mica">
                                        <img src="assets/fie.png" alt="Logo FIE" onerror="this.style.display='none'" />
                                    </div>
                                </div>
                                
                                <!-- Esquinas decorativas -->
                                <div class="corner-decoration corner-top-left"></div>
                                <div class="corner-decoration corner-top-right"></div>
                                <div class="corner-decoration corner-bottom-left"></div>
                                <div class="corner-decoration corner-bottom-right"></div>
                                
                                <!-- Decoraciones -->
                                <div class="notebook-decoration decoration-1"></div>
                                <div class="notebook-decoration decoration-2"></div>
                                
                                <!-- Etiqueta principal -->
                                <div class="notebook-label">
                                    <div class="cover-title">üìö Universidad Nacional del Altiplano üéì</div>
                                    <div class="cover-subtitle">Facultad de Ingenier√≠a Econ√≥mica</div>
                                    <div class="cover-subtitle">Escuela Profesional de Ingenier√≠a Econ√≥mica</div>
                                    <div class="cover-subtitle">Cuaderno de Apuntes</div>
                                </div>
                                
                                <!-- Informaci√≥n del estudiante -->
                                <div class="student-info">
                                    <div class="info-line">
                                        <span class="info-label">Estudiante:</span>
                                        <span class="info-value">Edaly Yamileth Paredes Condori</span>
                                    </div>
                                    <div class="info-line">
                                        <span class="info-label">Materia:</span>
                                        <span class="info-value">Macroeconom√≠a I</span>
                                    </div>
                                    <div class="info-line">
                                        <span class="info-label">Per√≠odo:</span>
                                        <span class="info-value">2025 - II</span>
                                    </div>
                                    <div class="info-line">
                                        <span class="info-label">Universidad:</span>
                                        <span class="info-value">Universidad Nacional del Altiplano</span>
                                    </div>
                                    <div class="info-line">
                                        <span class="info-label">Carrera:</span>
                                        <span class="info-value">Ingenier√≠a Econ√≥mica</span>
                                    </div>
                                    <div class="info-line">
                                        <span class="info-label">Profesor:</span>
                                        <span class="info-value">Humberto Calizaya Coila</span>
                                    </div>
                                </div>
                                
                                <!-- Botones de navegaci√≥n -->
                                <div class="start-buttons">
                                    <button class="start-btn" onclick="selectUnit(1)">üìñ Unidad I</button>
                                    <button class="start-btn" onclick="selectUnit(2)">üìä Unidad II</button>
                                </div>
                            </div>
                        `
                    }
                ]
            },
            2: { // Unidad II
                title: "Unidad II: El Modelo OA-DA",
                pages: Array.from({ length: 25 }, () => ({}))
            },
            


/* P√°gina removida: Tramo final de Unidad I (contenido inline eliminado) */
            
            1: { // Unidad I
                title: "Unidad I: Modelo IS-LM y Mundell-Fleming",
                pages: Array.from({ length: 50 }, () => ({}))
            },
            
        };

        // Slim: sobrescribe p√°ginas para evitar duplicidad y usar archivos externos
        try {
            if (unidades && unidades[1]) {
                unidades[1].pages = Array.from({ length: 50 }, () => ({}));
            }
            if (unidades && unidades[2]) {
                unidades[2].pages = Array.from({ length: 25 }, () => ({}));
            }
        } catch (e) {
            console.warn('No se pudo simplificar p√°ginas de unidades:', e);
        }

        // Funci√≥n para cargar contenido
        function loadContent() {
            const unit = unidades[currentUnit];
            if (!unit || !unit.pages[currentPageIndex]) {
                document.getElementById('page-content').innerHTML = '<div class="handwritten-text">P√°gina no encontrada</div>';
                return;
            }

            const page = unit.pages[currentPageIndex];
            const pageContentEl = document.getElementById('page-content');
            const unitResources = {
                1: { assetsBase: '/assets/unidad1/', docsBase: '/content/unidad1/' },
                2: { assetsBase: '/assets/unidad2/', docsBase: '/content/unidad2/' }
            };
            const resources = unitResources[currentUnit] || null;

            function rewriteRelativeAssets(container, shouldRewrite) {
                if (!shouldRewrite || !resources) return;
                const prefix = (p) => p ? p : '';
                // Im√°genes
                container.querySelectorAll('img[src]').forEach(img => {
                    const origSrc = img.getAttribute('src');
                    if (!origSrc) return;
                    const isExternal = /^(https?:\/\/|data:)/.test(origSrc);
                    const hasFolder = origSrc.includes('/');
                    if (!isExternal && !hasFolder) {
                        const targetSrc = prefix(resources.assetsBase) + origSrc;
                        img.setAttribute('src', targetSrc);
                        try { console.log('[img-rewrite]', { unit: currentUnit, orig: origSrc, final: img.getAttribute('src') }); } catch {}
                    }

                    // Fallback si falla la carga (intenta rutas alternativas b√°sicas)
                    img.addEventListener('error', function onErr() {
                        const fileName = (img.getAttribute('src') || '').split('/').pop();
                        const tries = img.getAttribute('data-fallback-tries') || '0';
                        const n = parseInt(tries, 10) || 0;
                        // Solo intentamos en la carpeta de assets; evitar '/content/...'
                        const candidates = [
                            (prefix(resources.assetsBase) + fileName).replace(/\/\/+/, '/')
                        ];
                        if (n < candidates.length) {
                            img.setAttribute('src', candidates[n]);
                            img.setAttribute('data-fallback-tries', String(n + 1));
                            try { console.warn('[img-fallback]', { try: n + 1, next: candidates[n] }); } catch {}
                        } else {
                            img.removeEventListener('error', onErr);
                            try { console.error('[img-error-final]', { src: img.getAttribute('src') }); } catch {}
                            // Fallback final: cargar como blob y usar ObjectURL
                            (async () => {
                                const abs = (prefix(resources.assetsBase) + fileName).replace(/\/\/+/, '/');
                                try {
                                    const resp = await fetch(abs);
                                    if (!resp.ok) throw new Error('No se pudo descargar imagen: ' + abs);
                                    const blob = await resp.blob();
                                    const url = URL.createObjectURL(blob);
                                    img.setAttribute('src', url);
                                    img.setAttribute('data-object-url', '1');
                                    try { console.warn('[img-blob-fallback]', { from: abs }); } catch {}
                                    img.addEventListener('load', () => {
                                        try { URL.revokeObjectURL(url); } catch {}
                                        img.removeAttribute('data-object-url');
                                    }, { once: true });
                                } catch (e) {
                                    // Si incluso el blob falla, renderizar como background-image
                                    try {
                                        const div = document.createElement('div');
                                        div.className = 'image-fallback';
                                        const alt = img.getAttribute('alt') || '';
                                        div.setAttribute('role', 'img');
                                        div.setAttribute('aria-label', alt);
                                        div.style.backgroundImage = `url(${abs})`;
                                        img.replaceWith(div);
                                        console.warn('[img-background-fallback]', { from: abs });
                                    } catch (ee) {
                                        try { console.error('[img-background-error]', ee); } catch {}
                                    }
                                }
                            })();
                        }
                    });
                });
                // Video sources
                container.querySelectorAll('source[src]').forEach(srcEl => {
                    const src = srcEl.getAttribute('src');
                    if (!src) return;
                    if (/^(https?:\/\/|\.\/|\/)/.test(src) || src.includes('/')) return;
                    srcEl.setAttribute('src', prefix(resources.assetsBase) + src);
                });
                // Document links (pdf/doc/ppt) y otros enlaces sin slash
                container.querySelectorAll('a[href]').forEach(a => {
                    const href = a.getAttribute('href');
                    if (!href) return;
                    if (/^(https?:\/\/|mailto:|tel:|#|\.\/|\/)/.test(href) || href.includes('/')) return;
                    const isDoc = /\.(pdf|docx?|pptx?|xlsx?)$/i.test(href);
                    a.setAttribute('href', prefix(isDoc ? resources.docsBase : resources.assetsBase) + href);
                });
                // iframes (videos/documentos)
                container.querySelectorAll('iframe[src]').forEach(iframe => {
                    const src = iframe.getAttribute('src');
                    if (!src) return;
                    if (/^(https?:\/\/|\.\/|\/)/.test(src) || src.includes('/')) return;
                    const isDoc = /\.(pdf|docx?|pptx?|xlsx?)$/i.test(src);
                    iframe.setAttribute('src', prefix(isDoc ? resources.docsBase : resources.assetsBase) + src);
                });
            }
            const externalMap = {
                // Unidad I: p√°ginas 1‚Äì10 agrupadas
                '1:0': 'content/unidad1/group_1-10.html#page-1',
                '1:1': 'content/unidad1/group_1-10.html#page-2',
                '1:2': 'content/unidad1/group_1-10.html#page-3',
                '1:3': 'content/unidad1/group_1-10.html#page-4',
                '1:4': 'content/unidad1/group_1-10.html#page-5',
                '1:5': 'content/unidad1/group_1-10.html#page-6',
                '1:6': 'content/unidad1/group_1-10.html#page-7',
                '1:7': 'content/unidad1/group_1-10.html#page-8',
                '1:8': 'content/unidad1/group_1-10.html#page-9',
                '1:9': 'content/unidad1/group_1-10.html#page-10',
                // Unidad I: p√°ginas 11‚Äì20 agrupadas
                '1:10': 'content/unidad1/group_11-20.html#page-11',
                '1:11': 'content/unidad1/group_11-20.html#page-12',
                '1:12': 'content/unidad1/group_11-20.html#page-13',
                '1:13': 'content/unidad1/group_11-20.html#page-14',
                '1:14': 'content/unidad1/group_11-20.html#page-15',
                '1:15': 'content/unidad1/group_11-20.html#page-16',
                '1:16': 'content/unidad1/group_11-20.html#page-17',
                '1:17': 'content/unidad1/group_11-20.html#page-18',
                '1:18': 'content/unidad1/group_11-20.html#page-19',
                '1:19': 'content/unidad1/group_11-20.html#page-20',
                // Unidad I: p√°ginas 21‚Äì30 agrupadas
                '1:20': 'content/unidad1/group_21-30.html#page-21',
                '1:21': 'content/unidad1/group_21-30.html#page-22',
                '1:22': 'content/unidad1/group_21-30.html#page-23',
                '1:23': 'content/unidad1/group_21-30.html#page-24',
                '1:24': 'content/unidad1/group_21-30.html#page-25',
                '1:25': 'content/unidad1/group_21-30.html#page-26',
                '1:26': 'content/unidad1/group_21-30.html#page-27',
                '1:27': 'content/unidad1/group_21-30.html#page-28',
                '1:28': 'content/unidad1/group_21-30.html#page-29',
                '1:29': 'content/unidad1/group_21-30.html#page-30',
                // Unidad I: p√°ginas 31‚Äì40 agrupadas
                '1:30': 'content/unidad1/group_31-40.html#page-31',
                '1:31': 'content/unidad1/group_31-40.html#page-32',
                '1:32': 'content/unidad1/group_31-40.html#page-33',
                '1:33': 'content/unidad1/group_31-40.html#page-34',
                '1:34': 'content/unidad1/group_31-40.html#page-35',
                '1:35': 'content/unidad1/group_31-40.html#page-36',
                '1:36': 'content/unidad1/group_31-40.html#page-37',
                '1:37': 'content/unidad1/group_31-40.html#page-38',
                '1:38': 'content/unidad1/group_31-40.html#page-39',
                '1:39': 'content/unidad1/group_31-40.html#page-40',
                // Unidad I: p√°ginas 41‚Äì50 agrupadas
                '1:40': 'content/unidad1/group_41-50.html#page-41',
                '1:41': 'content/unidad1/group_41-50.html#page-42',
                '1:42': 'content/unidad1/group_41-50.html#page-43',
                '1:43': 'content/unidad1/group_41-50.html#page-44',
                '1:44': 'content/unidad1/group_41-50.html#page-45',
                '1:45': 'content/unidad1/group_41-50.html#page-46',
                '1:46': 'content/unidad1/group_41-50.html#page-47',
                '1:47': 'content/unidad1/group_41-50.html#page-48',
                '1:48': 'content/unidad1/group_41-50.html#page-49',
                '1:49': 'content/unidad1/group_41-50.html#page-50',
                // Unidad II: p√°ginas 1‚Äì10 agrupadas
                '2:0': 'content/unidad2/group_1-10.html#page-1',
                '2:1': 'content/unidad2/group_1-10.html#page-2',
                '2:2': 'content/unidad2/group_1-10.html#page-3',
                '2:3': 'content/unidad2/group_1-10.html#page-4',
                '2:4': 'content/unidad2/group_1-10.html#page-5',
                '2:5': 'content/unidad2/group_1-10.html#page-6',
                '2:6': 'content/unidad2/group_1-10.html#page-7',
                '2:7': 'content/unidad2/group_1-10.html#page-8',
                '2:8': 'content/unidad2/group_1-10.html#page-9',
                '2:9': 'content/unidad2/group_1-10.html#page-10',
                // Unidad II: p√°ginas 11‚Äì20 agrupadas
                '2:10': 'content/unidad2/group_11-20.html#page-11',
                '2:11': 'content/unidad2/group_11-20.html#page-12',
                '2:12': 'content/unidad2/group_11-20.html#page-13',
                '2:13': 'content/unidad2/group_11-20.html#page-14',
                '2:14': 'content/unidad2/group_11-20.html#page-15',
                '2:15': 'content/unidad2/group_11-20.html#page-16',
                '2:16': 'content/unidad2/group_11-20.html#page-17',
                '2:17': 'content/unidad2/group_11-20.html#page-18',
                '2:18': 'content/unidad2/group_11-20.html#page-19',
                '2:19': 'content/unidad2/group_11-20.html#page-20'
                ,
                // Unidad II: p√°ginas 21‚Äì25 agrupadas
                '2:20': 'content/unidad2/group_21-25.html#page-21',
                '2:21': 'content/unidad2/group_21-25.html#page-22',
                '2:22': 'content/unidad2/group_21-25.html#page-23',
                '2:23': 'content/unidad2/group_21-25.html#page-24',
                '2:24': 'content/unidad2/group_21-25.html#page-25'
            };
            const externalKey = `${currentUnit}:${currentPageIndex}`;
            const externalFile = externalMap[externalKey];
            // Reescritura previa en HTML para evitar primeras cargas err√≥neas
            function rewriteHtmlStringAssets(html) {
                if (!resources || !html) return html;
                let out = html;
                function rewriteAttr(tag, attr) {
                    const re = new RegExp(`(<${tag}[^>]*${attr}=["'])([^"']+)(["'])`, 'gi');
                    out = out.replace(re, (m, p1, val, p3) => {
                        if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                        return `${p1}${resources.assetsBase}${val}${p3}`;
                    });
                }
                rewriteAttr('img', 'src');
                rewriteAttr('source', 'src');
                // Enlaces a documentos
                out = out.replace(/(<a[^>]*href=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|mailto:|tel:|#|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                // iframes
                out = out.replace(/(<iframe[^>]*src=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                return out;
            }

            const resolveAndInject = (fileSpec) => {
                const [path, fragment] = fileSpec.split('#');
                return fetch(path)
                    .then(r => r.ok ? r.text() : Promise.reject(new Error('No se pudo cargar '+path)))
                    .then(html => {
                        try { console.log('[inject]', { path, fragment, unit: currentUnit }); } catch {}
                        if (fragment) {
                            const tmp = document.createElement('div');
                            tmp.innerHTML = html;
                            const node = tmp.querySelector(`#${fragment}`);
                            const fragmentHtml = node ? node.innerHTML : html;
                            pageContentEl.innerHTML = rewriteHtmlStringAssets(fragmentHtml);
                        } else {
                            pageContentEl.innerHTML = rewriteHtmlStringAssets(html);
                        }
                        rewriteRelativeAssets(pageContentEl, true);
                        // Correcci√≥n agresiva: forzar rutas de im√°genes a assets/unidadX si siguen sin resolverse
                        (function forceFixImages() {
                            const unitFolder = currentUnit === 1 ? '/assets/unidad1/' : (currentUnit === 2 ? '/assets/unidad2/' : '/assets/');
                            pageContentEl.querySelectorAll('img[src]').forEach(img => {
                                const src = img.getAttribute('src') || '';
                                if (/^https?:\/\//.test(src) || src.startsWith('data:')) return;
                                const fileName = src.split('/').pop();
                                const desired = unitFolder + fileName;
                                if (src !== desired) {
                                    img.setAttribute('src', desired);
                                    try { console.log('[img-force]', { from: src, to: desired }); } catch {}
                                }
                                img.addEventListener('error', () => {
                                    const fallback = desired.startsWith('/') ? desired : ('/' + desired);
                                    img.setAttribute('src', fallback);
                                    try { console.warn('[img-force-fallback]', { to: fallback }); } catch {}
                                }, { once: true });
                            });
                        })();
                        initNotes();
                    })
                    .catch(err => { pageContentEl.innerHTML = '<div class="error-box">'+err.message+'</div>'; });
            };
            if (externalFile) {
                resolveAndInject(externalFile);
            } else if (page.file) {
                resolveAndInject(page.file);
            } else {
                pageContentEl.innerHTML = page.content;
                rewriteRelativeAssets(pageContentEl, false);
                initNotes();
            }
            document.getElementById('page-number').textContent = currentPageIndex + 1;

            // Agregar atributo data-unit para controlar la visibilidad del logo
            const notebookPage = document.getElementById('current-page');
            notebookPage.setAttribute('data-unit', currentUnit);

            // Actualizar botones
            updateButtons();

            // Actualizar highlight del men√∫
            updateCurrentPageHighlight();

            // Refrescar selector de grupos (bloques de 10)
            refreshGroupSelect();

            // initNotes ya se llama tras inyectar contenido
        }

        // Funci√≥n para actualizar botones
        function updateButtons() {
            const unit = unidades[currentUnit];
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const autoBtn = document.getElementById('auto-btn');

            if (unit && unit.pages) {
                prevBtn.disabled = currentPageIndex === 0;
                nextBtn.disabled = currentPageIndex >= unit.pages.length - 1;
                autoBtn.disabled = false;
            } else {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                autoBtn.disabled = true;
            }
        }

        // Funci√≥n para pasar p√°gina
        function nextPage() {
            const unit = unidades[currentUnit];
            if (unit && currentPageIndex < unit.pages.length - 1) {
                currentPageIndex++;
                flipPage();
            }
        }

        // Funci√≥n para p√°gina anterior
        function previousPage() {
            if (currentPageIndex > 0) {
                currentPageIndex--;
                flipPage();
            }
        }

        // Funci√≥n para animar el cambio de p√°gina
        function flipPage() {
            const page = document.getElementById('current-page');
            page.classList.add('page-flipping');
            createPaperSound();

            setTimeout(() => {
                loadContent();
                page.classList.remove('page-flipping');
            }, 600);
        }

        // Funci√≥n para auto-flip
        function autoFlip() {
            if (isAutoFlipping) {
                isAutoFlipping = false;
                document.getElementById('auto-btn').textContent = 'üîÑ Auto';
                return;
            }

            isAutoFlipping = true;
            document.getElementById('auto-btn').textContent = '‚è∏Ô∏è Parar';

            const autoFlipInterval = setInterval(() => {
                if (!isAutoFlipping) {
                    clearInterval(autoFlipInterval);
                    return;
                }

                const unit = unidades[currentUnit];
                if (unit && currentPageIndex < unit.pages.length - 1) {
                    nextPage();
                } else {
                    isAutoFlipping = false;
                    document.getElementById('auto-btn').textContent = 'üîÑ Auto';
                    clearInterval(autoFlipInterval);
                }
            }, 3000);
        }

        // Funci√≥n para seleccionar unidad
        function selectUnit(unitNumber) {
            currentUnit = unitNumber;
            currentPageIndex = 0;
            loadContent();
        }

        // Funci√≥n para ir a la portada
        function goToHome() {
            currentUnit = 0;
            currentPageIndex = 0;
            loadContent();
        }

        // Funciones del men√∫ desplegable
        function toggleNavMenu() {
            const dropdown = document.getElementById('nav-dropdown');
            const btn = document.querySelector('.nav-menu-btn');

            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                btn.classList.remove('active');
            } else {
                dropdown.classList.add('show');
                btn.classList.add('active');
                updateCurrentPageHighlight();
            }
        }

        function goToPage(unitNumber, pageIndex) {
            currentUnit = unitNumber;
            currentPageIndex = pageIndex;
            loadContent();

            // Cerrar el men√∫ despu√©s de navegar
            const dropdown = document.getElementById('nav-dropdown');
            const btn = document.querySelector('.nav-menu-btn');
            dropdown.classList.remove('show');
            btn.classList.remove('active');

            // Crear sonido de papel
            createPaperSound();
        }

        function updateCurrentPageHighlight() {
            // Remover highlight anterior
            document.querySelectorAll('.nav-page-item').forEach(item => {
                item.classList.remove('current');
            });

            // Agregar highlight a la p√°gina actual
            const currentPageItems = document.querySelectorAll('.nav-page-item');
            if (currentUnit > 0 && currentPageItems.length > 0) {
                // Calcular el √≠ndice correcto basado en la unidad y p√°gina
                let totalIndex = 0;
                for (let unit = 1; unit < currentUnit; unit++) {
                    if (unidades[unit] && unidades[unit].pages) {
                        totalIndex += Math.min(unidades[unit].pages.length, 16); // Limitar a las p√°ginas mostradas en el men√∫
                    }
                }
                totalIndex += currentPageIndex;

                if (currentPageItems[totalIndex]) {
                    currentPageItems[totalIndex].classList.add('current');
                }
            }
        }

        // Selector de grupos: poblar y manejar cambios
        function refreshGroupSelect() {
            const select = document.getElementById('group-select');
            const container = document.querySelector('.group-select-container');
            if (!select || !container) return;
            const unit = unidades[currentUnit];
            if (!unit || !unit.pages || currentUnit === 0) {
                container.style.display = 'none';
                select.innerHTML = '';
                return;
            }
            const total = unit.pages.length;
            const groups = Math.ceil(total / 10);
            // Siempre mostrar el selector cuando hay una unidad activa,
            // incluso si solo hay un grupo (1‚ÄìN)
            const currentGroup = Math.floor(currentPageIndex / 10);
            // Rellenar opciones
            select.innerHTML = '';
            for (let g = 0; g < groups; g++) {
                const start = g * 10 + 1;
                const end = Math.min((g + 1) * 10, total);
                const opt = document.createElement('option');
                opt.value = String(g);
                opt.textContent = `Grupo ${g + 1} (${start}‚Äì${end})`;
                if (g === currentGroup) opt.selected = true;
                select.appendChild(opt);
            }
            container.style.display = 'block';
        }

        document.addEventListener('change', function(ev) {
            const select = document.getElementById('group-select');
            if (ev.target === select) {
                const g = parseInt(select.value, 10) || 0;
                const unit = unidades[currentUnit];
                if (!unit || !unit.pages) return;
                const targetIndex = Math.min(g * 10, unit.pages.length - 1);
                currentPageIndex = targetIndex;
                flipPage();
            }
        });

        // Inicializaci√≥n de notas locales y exportaci√≥n
        function initNotes() {
            const noteContainers = document.querySelectorAll('.notes');
            noteContainers.forEach(container => {
                const key = container.getAttribute('data-note-key');
                if (!key) return;
                const textarea = container.querySelector('textarea');
                const saveBtn = container.querySelector('[data-action="save"]');
                const clearBtn = container.querySelector('[data-action="clear"]');
                const storageKey = 'notebook-note-' + key;

                const saved = localStorage.getItem(storageKey);
                if (saved !== null && textarea) {
                    textarea.value = saved;
                }

                if (saveBtn && textarea) {
                    saveBtn.onclick = () => {
                        localStorage.setItem(storageKey, textarea.value || '');
                        createPaperSound();
                    };
                }

                if (clearBtn && textarea) {
                    clearBtn.onclick = () => {
                        textarea.value = '';
                        localStorage.removeItem(storageKey);
                        createPaperSound();
                    };
                }
            });
        }

        function exportNotes() {
            const prefix = 'notebook-note-';
            const notes = [];
            for (let i = 0; i < localStorage.length; i++) {
                const k = localStorage.key(i);
                if (k && k.startsWith(prefix)) {
                    notes.push({ key: k.substring(prefix.length), value: localStorage.getItem(k) || '' });
                }
            }
            const md = notes.map(n => `## ${n.key}\n\n${n.value}\n`).join('\n');
            const blob = new Blob([md], { type: 'text/markdown' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'apuntes-macroeconomia.md';
            a.click();
            URL.revokeObjectURL(a.href);
        }

        // Cerrar men√∫ al hacer clic fuera
        document.addEventListener('click', function (event) {
            const navMenu = document.querySelector('.nav-menu');
            const dropdown = document.getElementById('nav-dropdown');

            if (!navMenu.contains(event.target)) {
                dropdown.classList.remove('show');
                document.querySelector('.nav-menu-btn').classList.remove('active');
            }
        });

        // Funci√≥n para imprimir p√°ginas en formato A5 (2 por hoja A4)
        function printPages() {
            const printContainer = document.getElementById('print-container');
            printContainer.innerHTML = '';

            // Bases de recursos por unidad
            const unitResources = {
                1: { assetsBase: '/assets/unidad1/', docsBase: '/content/unidad1/' },
                2: { assetsBase: '/assets/unidad2/', docsBase: '/content/unidad2/' }
            };

            // Reescritura simple de assets para HTML plano
            function rewriteHtmlStringAssets(html, unitIndex) {
                const resources = unitResources[unitIndex];
                if (!resources || !html) return html;
                let out = html;
                function rewriteAttr(tag, attr) {
                    const re = new RegExp(`(<${tag}[^>]*${attr}=["'])([^"']+)(["'])`, 'gi');
                    out = out.replace(re, (m, p1, val, p3) => {
                        if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                        return `${p1}${resources.assetsBase}${val}${p3}`;
                    });
                }
                rewriteAttr('img', 'src');
                rewriteAttr('source', 'src');
                out = out.replace(/(<a[^>]*href=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|mailto:|tel:|#|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                out = out.replace(/(<iframe[^>]*src=["'])([^"']+)(["'])/gi, (m, p1, val, p3) => {
                    if (/^(https?:\/\/|\.\/|\/)/.test(val) || val.includes('/')) return m;
                    const isDoc = /(pdf|docx?|pptx?|xlsx?)$/i.test(val);
                    const base = isDoc ? resources.docsBase : resources.assetsBase;
                    return `${p1}${base}${val}${p3}`;
                });
                return out;
            }

            // Obtener especificaci√≥n de archivo externo por unidad/p√°gina
            function computeFileSpec(unitIndex, pageIndex) {
                const n = pageIndex + 1;
                let base = unitIndex === 1 ? 'content/unidad1/' : 'content/unidad2/';
                let file = '';
                if (unitIndex === 1) {
                    if (n <= 10) file = 'group_1-10.html';
                    else if (n <= 20) file = 'group_11-20.html';
                    else if (n <= 30) file = 'group_21-30.html';
                    else if (n <= 40) file = 'group_31-40.html';
                    else file = 'group_41-50.html';
                } else if (unitIndex === 2) {
                    if (n <= 10) file = 'group_1-10.html';
                    else if (n <= 20) file = 'group_11-20.html';
                    else file = 'group_21-25.html';
                }
                return `${base}${file}#page-${n}`;
            }

            // Recopilar todas las p√°ginas resolviendo HTML externo
            const tasks = [];
            let pageCounter = 1;
            for (let unitIndex = 1; unitIndex <= 2; unitIndex++) {
                const unit = unidades[unitIndex];
                if (!unit || !unit.pages || unit.pages.length === 0) continue;
                for (let p = 0; p < unit.pages.length; p++) {
                    const spec = computeFileSpec(unitIndex, p);
                    const [path, fragment] = spec.split('#');
                    tasks.push(
                        fetch(path)
                            .then(r => r.ok ? r.text() : Promise.reject(new Error('No se pudo cargar '+path)))
                            .then(html => {
                                let fragmentHtml = html;
                                if (fragment) {
                                    const tmp = document.createElement('div');
                                    tmp.innerHTML = html;
                                    const node = tmp.querySelector(`#${fragment}`);
                                    fragmentHtml = node ? node.innerHTML : html;
                                }
                                fragmentHtml = rewriteHtmlStringAssets(fragmentHtml, unitIndex);
                                return {
                                    content: fragmentHtml,
                                    pageNumber: pageCounter++,
                                    unitTitle: unit.title
                                };
                            })
                    );
                }
            }

            Promise.all(tasks).then(allPages => {
                console.log(`Total de p√°ginas a imprimir: ${allPages.length}`);
                if (allPages.length === 0) {
                    alert('No hay p√°ginas para imprimir');
                    return;
                }

                // Generar p√°ginas de impresi√≥n (2 p√°ginas A5 por hoja A4)
                for (let i = 0; i < allPages.length; i += 2) {
                    const printSheet = document.createElement('div');
                    printSheet.className = 'print-sheet';

                    const page1 = createPrintPage(allPages[i], allPages[i].pageNumber, allPages[i].unitTitle);
                    printSheet.appendChild(page1);
                    if (i + 1 < allPages.length) {
                        const page2 = createPrintPage(allPages[i + 1], allPages[i + 1].pageNumber, allPages[i + 1].unitTitle);
                        printSheet.appendChild(page2);
                    }
                    printContainer.appendChild(printSheet);
                }

                // Mostrar el contenedor de impresi√≥n para que las im√°genes se carguen
                printContainer.style.display = 'block';
                printContainer.style.visibility = 'hidden';
                printContainer.style.position = 'absolute';
                printContainer.style.top = '0';
                printContainer.style.left = '0';
                printContainer.style.zIndex = '1';
                printContainer.style.background = 'white';
                printContainer.style.width = '100%';
                printContainer.style.height = 'auto';

                // Precargar todas las im√°genes
                const images = printContainer.querySelectorAll('img');
                console.log(`Encontradas ${images.length} im√°genes para imprimir`);
                let loadedImages = 0;
                const totalImages = images.length;

                function checkAllImagesLoaded() {
                    loadedImages++;
                    if (loadedImages >= totalImages) {
                        setTimeout(() => {
                            printContainer.style.visibility = 'visible';
                            printContainer.style.display = 'block';
                            document.querySelector('.sidebar').style.display = 'none';
                            document.querySelector('.notebook-container').style.display = 'none';
                            setTimeout(() => { window.print(); }, 500);
                        }, 500);
                    }
                }

                if (totalImages === 0) {
                    setTimeout(() => {
                        printContainer.style.visibility = 'visible';
                        printContainer.style.display = 'block';
                        document.querySelector('.sidebar').style.display = 'none';
                        document.querySelector('.notebook-container').style.display = 'none';
                        setTimeout(() => { window.print(); }, 500);
                    }, 500);
                    return;
                }

                images.forEach((img) => {
                    if (img.complete && img.naturalHeight !== 0) {
                        checkAllImagesLoaded();
                    } else {
                        img.addEventListener('load', checkAllImagesLoaded);
                        img.addEventListener('error', checkAllImagesLoaded);
                        const originalSrc = img.src; img.src = ''; img.src = originalSrc;
                    }
                });

                setTimeout(() => {
                    if (loadedImages < totalImages) {
                        printContainer.style.visibility = 'visible';
                        printContainer.style.display = 'block';
                        document.querySelector('.sidebar').style.display = 'none';
                        document.querySelector('.notebook-container').style.display = 'none';
                        setTimeout(() => { window.print(); }, 500);
                    }
                }, 10000);
            }).catch(err => {
                alert('Error preparando impresi√≥n: ' + err.message);
            });
        }

        // Funci√≥n para restaurar la vista despu√©s de imprimir
        function restoreView() {
            const printContainer = document.getElementById('print-container');
            printContainer.style.display = 'none';
            printContainer.style.visibility = 'hidden';
            document.querySelector('.sidebar').style.display = 'block';
            document.querySelector('.notebook-container').style.display = 'block';
        }

        // Detectar cuando se cierra el di√°logo de impresi√≥n
        window.addEventListener('afterprint', restoreView);

        // Funci√≥n auxiliar para crear una p√°gina de impresi√≥n
        function createPrintPage(pageData, pageNumber, unitTitle) {
            const printPage = document.createElement('div');
            printPage.className = 'print-page';

            // Mantener el contenido HTML exactamente como aparece en pantalla
            const originalContent = pageData.content;

            printPage.innerHTML = `
                <div class="print-page-header">
                    ${unitTitle} - P√°gina ${pageNumber}
                </div>
                <img src="assets/fie.png" alt="Logo FIE" class="fie-logo" onerror="this.style.display='none'">
                <div class="print-page-content">
                    ${originalContent}
                </div>
                <div class="print-page-number">${pageNumber}</div>
            `;

            return printPage;
        }

        // Inicializar
        const ENABLE_KEYBOARD_NAV = true; // Habilitar flechas en escritorio (laptop/PC)
        document.addEventListener('DOMContentLoaded', function () {
            loadContent();
        });

        // Atajos de teclado (desactivados cuando ENABLE_KEYBOARD_NAV = false)
        document.addEventListener('keydown', function (e) {
            if (!ENABLE_KEYBOARD_NAV) return;
            // Evitar interferir cuando el foco est√° en campos editables
            const tag = (e.target && e.target.tagName || '').toLowerCase();
            const editable = e.target && (e.target.isContentEditable || tag === 'input' || tag === 'textarea' || tag === 'select');
            if (editable) return;

            if (e.key === 'ArrowRight' || e.key === ' ') {
                e.preventDefault();
                if (typeof nextPage === 'function') nextPage();
            } else if (e.key === 'ArrowLeft') {
                e.preventDefault();
                if (typeof previousPage === 'function') previousPage();
            } else if (e.key === 'a' || e.key === 'A') {
                e.preventDefault();
                if (typeof autoFlip === 'function') autoFlip();
            }
        });
    </script>
    <!-- Bot√≥n de alternancia del modo de interacci√≥n -->
            <!-- Bot√≥n de alternancia ocultado por requerimiento: fijar siempre modo tap -->
            <!-- <button id="interactionToggle" class="interaction-toggle" title="Cambiar modo de interacci√≥n">Interacci√≥n: Tap/Swipe</button> -->
            <!-- Indicador m√≥vil de interacci√≥n -->
            <div id="tapHint" aria-live="polite" style="
              position: fixed;
              left: 50%;
              bottom: 16px;
              transform: translateX(-50%);
              background: rgba(0,0,0,0.75);
              color: #fff;
              padding: 8px 12px;
              border-radius: 12px;
              font-size: 14px;
              box-shadow: 0 2px 10px rgba(0,0,0,0.3);
              z-index: 1000;
              display: none;
            ">Toca para avanzar ¬∑ doble toque para retroceder</div>

    <!-- Acciones flotantes para m√≥vil -->
    <div class="floating-actions" aria-label="Acciones r√°pidas">
        <button id="faMenu" class="fab" title="Ir a Tema">üìö</button>
        <button id="faPrint" class="fab" title="Imprimir">üñ®Ô∏è</button>
    </div>

    <!-- Interacciones: tap para avanzar y swipe para navegar -->
    <script>
        (function() {
            const STORAGE_KEY = 'interactionMode';
            const DEFAULT_MODE = 'tap'; // solo click/tap por defecto
            let interactionMode = localStorage.getItem(STORAGE_KEY) || DEFAULT_MODE;
            let singleTapTimer = null;
            const SINGLE_TAP_DELAY = 250;

            function setToggleLabel() {
                const toggle = document.getElementById('interactionToggle');
                if (!toggle) return;
                const label = interactionMode === 'tap' ? 'Interacci√≥n: Tap' : interactionMode === 'swipe' ? 'Interacci√≥n: Swipe' : 'Interacci√≥n: Tap/Swipe';
                toggle.textContent = label;
            }

            function cycleInteractionMode() {
                interactionMode = interactionMode === 'tap_swipe' ? 'tap' : interactionMode === 'tap' ? 'swipe' : 'tap_swipe';
                localStorage.setItem(STORAGE_KEY, interactionMode);
                setToggleLabel();
            }

            function initInteractions() {
                if (window.__interactionsBound) return;
                window.__interactionsBound = true;

                // Prioriza el √°rea de contenido para evitar capturar clics en la UI lateral
                const pageArea = document.getElementById('page-content') || document.querySelector('.notebook-page') || document.body;
                let startX = 0, startY = 0, isPointerDown = false;

                // Evitar que clics en elementos interactivos disparen navegaci√≥n
                function isInteractiveClick(evt) {
                    const interactiveSelectors = 'button, a, .nav-menu-btn, .nav-btn, .fab, .floating-actions, .nav-dropdown, .start-btn, #faMenu, #faPrint';
                    return !!evt.target.closest(interactiveSelectors);
                }

                // Tap/click: single tap = siguiente, double tap = anterior
                pageArea.addEventListener('click', function(e) {
                    if (isInteractiveClick(e)) return;
                    if (interactionMode === 'swipe') return; // solo swipe
                    if (singleTapTimer) {
                        clearTimeout(singleTapTimer);
                        singleTapTimer = null;
                        if (typeof previousPage === 'function') previousPage();
                        return;
                    }
                    singleTapTimer = setTimeout(function() {
                        singleTapTimer = null;
                        if (typeof nextPage === 'function') nextPage();
                    }, SINGLE_TAP_DELAY);
                });

                // Swipe/arrastre: navegar
                function getPoint(evt) {
                    if (evt.changedTouches && evt.changedTouches.length) {
                        return { x: evt.changedTouches[0].clientX, y: evt.changedTouches[0].clientY };
                    }
                    if (evt.touches && evt.touches.length) {
                        return { x: evt.touches[0].clientX, y: evt.touches[0].clientY };
                    }
                    return { x: evt.clientX, y: evt.clientY };
                }

                pageArea.addEventListener('pointerdown', function(e) {
                    if (interactionMode === 'tap') return; // solo tap
                    isPointerDown = true;
                    const p = getPoint(e);
                    startX = p.x; startY = p.y;
                });

                pageArea.addEventListener('pointerup', function(e) {
                    if (isInteractiveClick(e)) return;
                    if (interactionMode === 'tap') return; // solo tap
                    if (!isPointerDown) return;
                    isPointerDown = false;
                    const p = getPoint(e);
                    const dx = p.x - startX;
                    const dy = p.y - startY;
                    if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(dy)) {
                        if (dx < 0) {
                            if (typeof nextPage === 'function') nextPage();
                        } else {
                            if (typeof previousPage === 'function') previousPage();
                        }
                    } else if (interactionMode === 'tap_swipe') {
                        // gesto corto: tratar como tap
                        if (typeof nextPage === 'function') nextPage();
                    }
                });

                // Soporte para touchstart/touchend (algunos navegadores m√≥viles)
                pageArea.addEventListener('touchstart', function(e) {
                    if (interactionMode === 'tap') return;
                    const p = getPoint(e);
                    isPointerDown = true;
                    startX = p.x; startY = p.y;
                }, { passive: true });

                pageArea.addEventListener('touchend', function(e) {
                    if (isInteractiveClick(e)) return;
                    if (interactionMode === 'tap') return;
                    if (!isPointerDown) return;
                    isPointerDown = false;
                    const p = getPoint(e);
                    const dx = p.x - startX;
                    const dy = p.y - startY;
                    if (Math.abs(dx) > 50 && Math.abs(dx) > Math.abs(dy)) {
                        if (dx < 0) {
                            if (typeof nextPage === 'function') nextPage();
                        } else {
                            if (typeof previousPage === 'function') previousPage();
                        }
                    } else if (interactionMode === 'tap_swipe') {
                        if (typeof nextPage === 'function') nextPage();
                    }
                }, { passive: true });
            }

            // Indicador m√≥vil: muestra una pista de "Toca para avanzar / doble toque para retroceder"
            function showTapHintIfMobile() {
                const hint = document.getElementById('tapHint');
                if (!hint) return;
                const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
                const isSmallViewport = window.innerWidth <= 768;
                if (!(isTouchDevice || isSmallViewport)) return;

                // Mostrar la pista
                hint.style.display = 'block';

                // Ocultar tras interacci√≥n inicial o tras un tiempo
                const pageArea = document.querySelector('.notebook-page') || document.getElementById('page-content') || document.body;
                const hideOnce = () => {
                    hint.style.display = 'none';
                    pageArea.removeEventListener('click', hideOnce);
                    pageArea.removeEventListener('touchend', hideOnce);
                    pageArea.removeEventListener('pointerup', hideOnce);
                };
                pageArea.addEventListener('click', hideOnce, { once: true });
                pageArea.addEventListener('touchend', hideOnce, { once: true });
                pageArea.addEventListener('pointerup', hideOnce, { once: true });
                setTimeout(hideOnce, 5000);
            }

            document.addEventListener('DOMContentLoaded', function() {
                const toggle = document.getElementById('interactionToggle');
                if (toggle) toggle.addEventListener('click', cycleInteractionMode);
                setToggleLabel();
                initInteractions();
                if (!window.__tapHintShown) { showTapHintIfMobile(); window.__tapHintShown = true; }

                // Acciones flotantes
                const faMenu = document.getElementById('faMenu');
                const faPrint = document.getElementById('faPrint');
                if (faMenu) faMenu.addEventListener('click', function(){ if (typeof toggleNavMenu === 'function') toggleNavMenu(); });
                if (faPrint) faPrint.addEventListener('click', function(){ window.print(); });
            });

            // Reaplicar interacciones tras cambios de p√°gina
            const originalLoadContent = typeof loadContent === 'function' ? loadContent : null;
            if (originalLoadContent) {
                window.loadContent = function(pageNumber) {
                    originalLoadContent(pageNumber);
                    setToggleLabel();
                    initInteractions();
                }
            }
        })();
    </script>
</body>

</html>
